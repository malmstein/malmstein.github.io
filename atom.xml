<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[David Gonzalez]]></title>
  <link href="http://malmstein.github.io/atom.xml" rel="self"/>
  <link href="http://malmstein.github.io/"/>
  <updated>2015-03-28T18:13:09+00:00</updated>
  <id>http://malmstein.github.io/</id>
  <author>
    <name><![CDATA[David Gonzalez]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Introducing Yahnac: Where RxJava Meets Firebase and Content Providers]]></title>
    <link href="http://malmstein.github.io/blog/2015/03/28/introducing-yahnac-where-rxjava-meets-content-providers/"/>
    <updated>2015-03-28T09:45:57+00:00</updated>
    <id>http://malmstein.github.io/blog/2015/03/28/introducing-yahnac-where-rxjava-meets-content-providers</id>
    <content type="html"><![CDATA[<p>What&rsquo;s <strong>Yahnac</strong> you might ask? Yet another <a href="https://news.ycombinator.com/">Hacker News</a> client, because there are never enough Hacker News clients out there!</p>

<p>For those who don&rsquo;t know, <a href="https://news.ycombinator.com/">Hacker News</a> is a social news website focusing on computer science and entrepreneurship and it is run by the startup incubator <a href="https://www.ycombinator.com/">Y Combinator</a>. In general, content that can be submitted is defined as &ldquo;anything that gratifies one&rsquo;s intellectual curiosity&rdquo;.</p>

<p>Not so long ago Y Combinator <a href="http://blog.ycombinator.com/hacker-news-api">announced</a> a long awaited <a href="https://github.com/HackerNews/API">API for Hacker News</a>. Although it was pretty basic and simple, the most exciting piece of news to me was that the API was built using <a href="https://www.firebase.com/">Firebase</a>.</p>

<p>In terms of features, <strong>Yahnac allows you to read all Hacker News content from Hacker News from Top Stories to Jobs</strong>. On top of that, <strong>you&rsquo;ll be able to add Bookmarks</strong> and keep them as long as you like.</p>

<p>If you are interested in knowing how <strong>Yahnac</strong> has been built, please do Read on!</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/top_stories.png"></p>

<!-- more -->


<h1>A confession to make</h1>

<p>Doctor, I have to confess. I like <a href="http://developer.android.com/guide/components/loaders.html">Loaders</a>, <a href="http://developer.android.com/guide/topics/providers/content-providers.html">Content Providers</a> and their boilerplate. There is no point arguing if they are the best solution for everything, they are not.</p>

<p>A few months ago <a href="https://github.com/ReactiveX/RxJava">RxJava</a> started to become popular amongst <a href="http://novoda.com/">Novoda</a>. Applications like <a href="https://play.google.com/store/apps/details?id=com.novoda.dch">Digital Concert Hall</a> and <a href="https://play.google.com/store/apps/details?id=uk.co.thesun.mobile">The Sun</a> have been developed with reactive approach and the results are amazing.</p>

<p>Also, I&rsquo;m lucky enough to have people like <a href="http://uk.droidcon.com/2014/sessions/rx-fy-all-the-things/">Benjamin Augustin</a>, <a href="https://twitter.com/devisnik">Volker Leck</a> and <a href="https://twitter.com/mr_archano">Antonio Bertucci</a> around the office, who strongly believe in the benefits of reactive programming and it&rsquo;s applications to Android.</p>

<p>Following these principles I started a journey to wrap all these Framework specific solutions together with <code>Rx</code> and <code>Firebase</code>, a very different approach to conventional Rest APIs.</p>

<h1>Architecture</h1>

<p>The principle is very simple, it doesn&rsquo;t matter how the data is retrieved from the network since all I really care is to store it into the database in a meaningful way and display it as quick as possible. These very distinct responsibilities can be handled by <code>Rx</code> on the networking layer, <a href="https://www.sqlite.org/">SQlite</a> in the database layer and <code>Loaders</code> in the UI layer.</p>

<p>Leveraging all the network and data manipulation onto <code>Rx</code> together with <code>Firebase</code> makes a lot of sense. <code>Firebase</code> data is <a href="https://www.firebase.com/docs/android/guide/retrieving-data.html">retrieved by attaching an asynchronous listener to a Firebase reference</a>. The listener will be triggered once for the initial state of the data and again anytime the data changes.</p>

<p>Based on the current implementation of the API, one needs to retrieve to 501 <code>Firebase</code> instances in order to display a list of <a href="https://github.com/HackerNews/API#new-and-top-stories">500 top stories</a>. One call will retrieve the id of all the items in the Top Stories page, then one needs to do another call for each one of those id and retrieve the data from the news item.</p>

<p><code>Rx</code> seems like a perfect candidate to solve all this, it&rsquo;s reactive approach allows to deal with all the recursive calls and threading seamlessly. It also allows to manipulate that data and provide with the output that the database layer needs. The output of this will be <a href="http://developer.android.com/reference/android/content/ContentValues.html">ContentValues</a>, which is what a <code>ContentProvider</code> needs.</p>

<p>On the UI layer, once we are using <code>ContentProvider</code> it&rsquo;s very easy to decide how to display the content. <a href="http://developer.android.com/reference/android/content/CursorLoader.html">CursorLoader</a> allows you to retrieve a <a href="http://developer.android.com/reference/android/database/Cursor.html">Cursor</a> with the desired data, it all made sense!</p>

<p>There was only one step more to be take, and that was to solve the incompatibility of <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.html">RecyclerView</a> and <code>Cursor</code>, in following post I&rsquo;ll deep dive into the actual implementation details and issues, stay tuned if you are interested.</p>

<h1>Supporting different form factors</h1>

<p>I had several doubts regarding the UI and how it would look like in different form factors. At the beginning I thought about using a <a href="http://developer.android.com/design/patterns/multi-pane-layouts.html">Multi Pane</a> but after using the app for a while something didn&rsquo;t feel right.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/tablet_old_ui.png"></p>

<p>The navigation wasn&rsquo;t very clear on landscape so I decided to use a <code>Staggered Grid</code> like the one <a href="https://codeascraft.com/">Etsy</a> made so popular back in the days.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/tablet_top_stories.png"></p>

<p>Same goes for smartphones, the UI will adapt from one column to two.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/smartphone_landscape.png"></p>

<h1>We live in a Material world</h1>

<p>No decent app nowadays should be shipped without <a href="http://www.google.com/design/spec/material-design/introduction.html">Material Design principles</a> and after <a href="https://speakerdeck.com/malmstein/what-material-design-means-to-android">talking</a> and <a href="https://speakerdeck.com/malmstein/material-animations">presenting</a> about it I couldn&rsquo;t be different.</p>

<p>The majority of articles are shown in a WebView, that does not leave a lot of space for transitions and fancy animations. The application has no pictures therefore beautiful <a href="https://developer.android.com/reference/android/support/v7/graphics/Palette.html">Palette</a> can&rsquo;t be added, not the best case scenario is it?</p>

<p>However, Material is not just animations and colors. Several aspects like <strong>typograhpy</strong>, <strong>spacing</strong> and <strong>ripples</strong> can easily be applied making a big difference.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/comments.png"></p>

<p>Another of the features that all Material applications show these days is the <strong>quick return pattern</strong>. It&rsquo;s a great idea and allows the user to enjoy more content while scrolling.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/yahnac.gif"></p>

<h1>Right, how do I get it?</h1>

<p><a href="https://play.google.com/store/apps/details?id=com.malmstein.yahnac"><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/play.png" alt="Get it on Google Play" /></a></p>

<h1>There&rsquo;s more to come</h1>

<p>The application is not finished, there are several feature that I&rsquo;d like to add like being able to publish a news item or replying to comments. Do yo fancy contributing? Please do! The <a href="https://github.com/malmstein/yahnac">source code is available in GitHub</a> and all PRs are welcome.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Finishing Your Very First Android TV Application]]></title>
    <link href="http://malmstein.github.io/blog/2014/11/15/finishing-your-very-first-android-tv-application/"/>
    <updated>2014-11-15T12:46:54+00:00</updated>
    <id>http://malmstein.github.io/blog/2014/11/15/finishing-your-very-first-android-tv-application</id>
    <content type="html"><![CDATA[<p>A few days ago <a href="" title="http://www.malmstein.com/blog/2014/10/21/building-applications-for-android-tv/">we started to build an Android TV application</a> and the feedback was very good. Today, it&rsquo;s time to take another step since we&rsquo;ll be publishing our
<a href="" title="https://github.com/malmstein/AndroidTVExplorer">AndroidTV Explorer</a> with some updates. After these updates, you&rsquo;ll be able to see the details of a video and stream it&rsquo;s content.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/AndroidTVExplorer/master/art/detail.gif"></p>

<!-- more -->


<p>Obviously, the application is not very useful right now. There is a list of videos and different
categories but there is no actual way to stream a video.</p>

<p>For that reason, there are two new components that we need to build. Those are
the video detail screen and the video player screen. Let&rsquo;s start with the detail one.</p>

<h1>DetailsFragment</h1>

<p>To keep things simple for now and fulfill the purpose of the series, we will use the <a href="http://developer.android.com/tools/support-library/features.html#v17-leanback">Leanback Support Library</a> again. This time, the <code>Widget</code> we are interested in is the <a href="https://developer.android.com/reference/android/support/v17/leanback/app/DetailsFragment.html">DetailsFragment</a>, which works in a similar way as the <code>BrowseFragment</code> used in the previous post.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/AndroidTVExplorer/master/art/detail.png"></p>

<h2>The Presenter</h2>

<p>Let me introduce you to the <a href="https://developer.android.com/reference/android/support/v17/leanback/widget/ClassPresenterSelector.html">ClassPresenterSelector</a>. Following the same
pattern as the <code>Presenter</code> used at the <code>BrowseFragment</code>, the <code>DetailsFragment</code> is going to use a <a href="https://developer.android.com/reference/android/support/v17/leanback/widget/DetailsOverviewRowPresenter.html">DetailsOverviewRowPresenter</a> which will present the information.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ClassPresenterSelector</span> <span class="n">ps</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ClassPresenterSelector</span><span class="o">();</span>
</span><span class='line'><span class="n">ps</span><span class="o">.</span><span class="na">addClassPresenter</span><span class="o">(</span><span class="n">DetailsOverviewRow</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">dorPresenter</span><span class="o">);</span>
</span><span class='line'><span class="n">ps</span><span class="o">.</span><span class="na">addClassPresenter</span><span class="o">(</span><span class="n">ListRow</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="nf">ListRowPresenter</span><span class="o">());</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, the <code>DetailsFragment</code> has two separate levels of information. There is a header or overview called <code>DetailsOverviewRowPresenter</code> which will show the detail of the video we interested in.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">DetailsOverviewRowPresenter</span> <span class="n">dorPresenter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">DetailsOverviewRowPresenter</span><span class="o">(</span><span class="k">new</span> <span class="nf">VideoDetailsPresenter</span><span class="o">());</span>
</span><span class='line'><span class="n">dorPresenter</span><span class="o">.</span><span class="na">setBackgroundColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">detail_background</span><span class="o">));</span>
</span><span class='line'><span class="n">dorPresenter</span><span class="o">.</span><span class="na">setStyleLarge</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>That corresponds to the Video detail information. It&rsquo;s the <a href="https://developer.android.com/reference/android/support/v17/leanback/widget/DetailsOverviewRow.html">DetailsOverviewRow</a> and consists of an image, a description view, and optionally a series of Actions that can be taken for the item.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">VideoDetailsPresenter</span> <span class="kd">extends</span> <span class="n">AbstractDetailsDescriptionPresenter</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onBindDescription</span><span class="o">(</span><span class="n">ViewHolder</span> <span class="n">viewHolder</span><span class="o">,</span> <span class="n">Object</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Video</span> <span class="n">details</span> <span class="o">=</span> <span class="o">(</span><span class="n">Video</span><span class="o">)</span> <span class="n">object</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">viewHolder</span><span class="o">.</span><span class="na">getTitle</span><span class="o">().</span><span class="na">setText</span><span class="o">(</span><span class="n">details</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
</span><span class='line'>  <span class="n">viewHolder</span><span class="o">.</span><span class="na">getSubtitle</span><span class="o">().</span><span class="na">setText</span><span class="o">(</span><span class="n">details</span><span class="o">.</span><span class="na">getStudio</span><span class="o">());</span>
</span><span class='line'>  <span class="n">viewHolder</span><span class="o">.</span><span class="na">getBody</span><span class="o">().</span><span class="na">setText</span><span class="o">(</span><span class="n">details</span><span class="o">.</span><span class="na">getDescription</span><span class="o">());</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The other important piece of information is the Related Videos section. In order to build that, the <code>DetailsFragment</code> asks the <code>ClassPresenterSelector</code> to show a <code>ListRowPresenter</code>. What are those related videos you may ask? We&rsquo;ll use the category of the video to get that information, basically showing all the videos from the same category.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ArrayObjectAdapter</span> <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ArrayObjectAdapter</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
</span><span class='line'><span class="n">adapter</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">detailRow</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">String</span> <span class="n">subcategories</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">related_movies</span><span class="o">)};</span>
</span><span class='line'><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Video</span><span class="o">&gt;&gt;</span> <span class="n">videos</span> <span class="o">=</span> <span class="n">VideoProvider</span><span class="o">.</span><span class="na">getMovieList</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="n">ArrayObjectAdapter</span> <span class="n">listRowAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ArrayObjectAdapter</span><span class="o">(</span><span class="k">new</span> <span class="nf">CardPresenter</span><span class="o">());</span>
</span><span class='line'><span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Video</span><span class="o">&gt;&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">videos</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="n">selectedVideo</span><span class="o">.</span><span class="na">getCategory</span><span class="o">().</span><span class="na">indexOf</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">())</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Video</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">listRowAdapter</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">HeaderItem</span> <span class="n">header</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">HeaderItem</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">subcategories</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'><span class="n">adapter</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">ListRow</span><span class="o">(</span><span class="n">header</span><span class="o">,</span> <span class="n">listRowAdapter</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Good, we are now able to see the video detail and some related videos but&hellip; how do we interact with the video?</p>

<h2>Easily adding actions</h2>

<p>For that purpose <code>DetailsFragment</code> exposes a very simple solution, the so called <code>Action</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">DetailsOverviewRow</span> <span class="n">detailRow</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">DetailsOverviewRow</span><span class="o">(</span><span class="n">selectedMovie</span><span class="o">);</span>
</span><span class='line'><span class="n">row</span><span class="o">.</span><span class="na">addAction</span><span class="o">(</span><span class="k">new</span> <span class="nf">Action</span><span class="o">(</span><span class="n">ACTION_WATCH_VIDEO</span><span class="o">,</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span>
</span><span class='line'><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">watch_video_1</span><span class="o">),</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">watch_video_2</span><span class="o">)));</span>
</span></code></pre></td></tr></table></div></figure>


<p>The element which will handle the <code>ActionClick</code> is the <code>DetailsOverviewRowPresenter</code>. Each of of the added actions is identified by it&rsquo;s <code>id</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">dorPresenter</span><span class="o">.</span><span class="na">setOnActionClickedListener</span><span class="o">(</span><span class="k">new</span> <span class="nf">OnActionClickedListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onActionClicked</span><span class="o">(</span><span class="n">Action</span> <span class="n">action</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">action</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="n">ACTION_WATCH_VIDEO</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="n">PlayerActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>      <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">video</span><span class="o">),</span> <span class="n">selectedVideo</span><span class="o">);</span>
</span><span class='line'>      <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="n">action</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Right, so there is some interaction here, let&rsquo;s stream the video once and for all. The TV is the perfect form factor for displaying videos, so that should be pretty straight forward!</p>

<h1>PlayerFragment</h1>

<p>Displaying a video is probably one of the most important use cases of Android TV. It&rsquo;s pretty clear at this point that the interaction between remote controller and device must be simple and
easy to use. For that reason the <code>TVPlayerFragment</code> was born.</p>

<p>The idea is pretty simple, tell the <code>Fragment</code> what to play and forget about the rest. One can press the keys in the remote and the expected behaviour will occur. The most interesting part is probably the direction arrows. When using them, I&rsquo;d expect to seek over the video if pressing left or right. It&rsquo;s all about accessing the <a href="http://developer.android.com/reference/android/view/KeyEvent.html#KEYCODE_MEDIA_PLAY_PAUSE">KeyEvents</a></p>

<p>Since this is a <code>Fragment</code>, the <code>KeyEvents</code> come filtered by the <code>Activity</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onKeyDown</span><span class="o">(</span><span class="kt">int</span> <span class="n">keyCode</span><span class="o">,</span> <span class="n">KeyEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="n">keyCode</span> <span class="o">==</span> <span class="n">KeyEvent</span><span class="o">.</span><span class="na">KEYCODE_DPAD_LEFT</span> <span class="o">||</span> <span class="n">keyCode</span> <span class="o">==</span> <span class="n">KeyEvent</span><span class="o">.</span><span class="na">KEYCODE_DPAD_RIGHT</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">((</span><span class="n">TVPlayerFragment</span><span class="o">)</span> <span class="n">getFragmentManager</span><span class="o">().</span><span class="na">findFragmentById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">player_fragment</span><span class="o">)).</span><span class="na">onKeyDown</span><span class="o">(</span><span class="n">keyCode</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onKeyDown</span><span class="o">(</span><span class="n">keyCode</span><span class="o">,</span> <span class="n">event</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onKeyDown</span><span class="o">(</span><span class="kt">int</span> <span class="n">keyCode</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">currentPos</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">delta</span> <span class="o">=</span> <span class="o">(</span><span class="n">videoDuration</span> <span class="o">/</span> <span class="n">SCRUB_SEGMENT_DIVISOR</span><span class="o">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="n">MIN_SCRUB_TIME</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">delta</span> <span class="o">=</span> <span class="n">MIN_SCRUB_TIME</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="o">(!</span><span class="n">areControllersVisible</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">updateControllersVisibility</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">switch</span> <span class="o">(</span><span class="n">keyCode</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">KeyEvent</span><span class="o">.</span><span class="na">KEYCODE_DPAD_LEFT</span><span class="o">:</span>
</span><span class='line'>      <span class="n">currentPos</span> <span class="o">=</span> <span class="n">videoView</span><span class="o">.</span><span class="na">getCurrentPosition</span><span class="o">();</span>
</span><span class='line'>      <span class="n">currentPos</span> <span class="o">-=</span> <span class="n">delta</span><span class="o">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">currentPos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">play</span><span class="o">(</span><span class="n">currentPos</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">KeyEvent</span><span class="o">.</span><span class="na">KEYCODE_DPAD_RIGHT</span><span class="o">:</span>
</span><span class='line'>      <span class="n">currentPos</span> <span class="o">=</span> <span class="n">videoView</span><span class="o">.</span><span class="na">getCurrentPosition</span><span class="o">();</span>
</span><span class='line'>      <span class="n">currentPos</span> <span class="o">+=</span> <span class="n">delta</span><span class="o">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">currentPos</span> <span class="o">&lt;</span> <span class="n">videoDuration</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">play</span><span class="o">(</span><span class="n">currentPos</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Even though we are displaying video in the TV we can&rsquo;t forget that this is still Android and we still have to deal with our beloved <code>MediaPlayer</code>. Some of you may have read about <a href="https://github.com/malmstein/fenster">Fenster</a>, a library I&rsquo;ve been working on that simplifies the way we stream video content. A few weeks ago we explained how the <code>MediaPlayer</code> lifecycle works and <a href="http://www.malmstein.com/blog/2014/08/09/how-to-use-a-textureview-to-display-a-video-with-custom-media-player-controls/">how to stream a video</a> in a very simple way.</p>

<p>Well, we still need to deal with those callbacks but we can do it a bit differently.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setMediaPlayerCallbacks</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">videoView</span><span class="o">.</span><span class="na">setOnErrorListener</span><span class="o">(</span><span class="k">new</span> <span class="n">MediaPlayer</span><span class="o">.</span><span class="na">OnErrorListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onError</span><span class="o">(</span><span class="n">MediaPlayer</span> <span class="n">mp</span><span class="o">,</span> <span class="kt">int</span> <span class="n">what</span><span class="o">,</span> <span class="kt">int</span> <span class="n">extra</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">videoView</span><span class="o">.</span><span class="na">stopPlayback</span><span class="o">();</span>
</span><span class='line'>      <span class="n">mPlaybackState</span> <span class="o">=</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="na">IDLE</span><span class="o">;</span>
</span><span class='line'>      <span class="n">controllersTimer</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Timer</span><span class="o">();</span>
</span><span class='line'>      <span class="n">controllersTimer</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="k">new</span> <span class="nf">BackToDetailTask</span><span class="o">(),</span> <span class="n">CLOSE_VIDEO_TIME</span><span class="o">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">videoView</span><span class="o">.</span><span class="na">setOnPreparedListener</span><span class="o">(</span><span class="k">new</span> <span class="n">MediaPlayer</span><span class="o">.</span><span class="na">OnPreparedListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPrepared</span><span class="o">(</span><span class="n">MediaPlayer</span> <span class="n">mp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">videoDuration</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="na">getDuration</span><span class="o">();</span>
</span><span class='line'>      <span class="n">endText</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">formatTimeSignature</span><span class="o">(</span><span class="n">videoDuration</span><span class="o">));</span>
</span><span class='line'>      <span class="n">videoSeekbar</span><span class="o">.</span><span class="na">setMax</span><span class="o">(</span><span class="n">videoDuration</span><span class="o">);</span>
</span><span class='line'>      <span class="n">restartSeekBarTimer</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">videoView</span><span class="o">.</span><span class="na">setOnCompletionListener</span><span class="o">(</span><span class="k">new</span> <span class="n">MediaPlayer</span><span class="o">.</span><span class="na">OnCompletionListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompletion</span><span class="o">(</span><span class="n">MediaPlayer</span> <span class="n">mp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">stopSeekBarTimer</span><span class="o">();</span>
</span><span class='line'>      <span class="n">mPlaybackState</span> <span class="o">=</span> <span class="n">PlaybackState</span><span class="o">.</span><span class="na">IDLE</span><span class="o">;</span>
</span><span class='line'>      <span class="n">updatePlayButton</span><span class="o">(</span><span class="n">PlaybackState</span><span class="o">.</span><span class="na">IDLE</span><span class="o">);</span>
</span><span class='line'>      <span class="n">controllersTimer</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Timer</span><span class="o">();</span>
</span><span class='line'>      <span class="n">controllersTimer</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="k">new</span> <span class="nf">BackToDetailTask</span><span class="o">(),</span> <span class="n">HIDE_CONTROLLER_TIME</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">});</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We are basically saying whenever there&rsquo;s an error we&rsquo;ll just navigate back to the video detail screen. The other thing we are saying is that the <code>SeekBar</code> position will be updated every second and not in the main thread.</p>

<p>At this point, we can stream video content and enjoy it in our Android TV!</p>

<h1>Show me the code</h1>

<p>You&rsquo;ll find the entire project on <a href="https://github.com/malmstein/AndroidTVExplorer">Github</a> and I&rsquo;ll be adding
more features along with all the blog posts of this series. As always, all <del>trolling</del> feedback is more than welcome!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Building Applications for Android TV]]></title>
    <link href="http://malmstein.github.io/blog/2014/10/21/building-applications-for-android-tv/"/>
    <updated>2014-10-21T00:19:05+01:00</updated>
    <id>http://malmstein.github.io/blog/2014/10/21/building-applications-for-android-tv</id>
    <content type="html"><![CDATA[<p>By now you all have heard about <a href="http://developer.android.com/about/versions/lollipop.html">the new Android release</a> and almost all of you have
played with new API and probably experimented with <a href="http://www.google.com/design/spec/material-design/introduction.html">Material Design</a>.</p>

<p>I have to say though, that one of the things that I&rsquo;m most excited about is <a href="http://developer.android.com/design/tv/index.html">Android TV</a>. I was very much into it <a href="http://www.google.com/tv/">before it was cool</a> but never got the chance to actually get hands on. Happily this has changed now and I&rsquo;ll be writing a series of posts about developing for Android TV, how to start, how to make your existing app compatible and how to make the most of it.</p>

<p>If you are interested, please read on!</p>

<p><img src="https://raw.githubusercontent.com/malmstein/AndroidTVExplorer/master/art/intro.gif"></p>

<!-- more -->


<p>Building applications for Android TV is not just developing and designing for an extremely big tablet. Yes, it is
a much bigger display but that&rsquo;s not the point. <strong>The interaction with the device is completely different compared to a phone</strong>, you are not going
to scroll through a 55 inches TV, are you? Same goes for the use cases, so far no one has been spotted reading the news in the underground on a <a href="http://www.engadget.com/2014/06/25/android-tv-is-coming-to-sony-sharp-and-philips-tvs-next-year/">Sony Bravia</a>.</p>

<h1>Support Libraries</h1>

<p>To make things a bit easier for us, Google has created a <a href="http://developer.android.com/tools/support-library/features.html#v17-leanback">Leanback Support Library</a> which contains APIs to support building user interfaces on TV devices. It provides a number of important widgets for TV apps which we&rsquo;ll make use in this project.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.android.support:recyclerview-v7:21.0.+&#39;</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.android.support:leanback-v17:21.0.+&#39;</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.android.support:appcompat-v7:21.0.+&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Demo project: The Android TV Explorer</h1>

<p>It&rsquo;s always easier to show and share while building stuff so I&rsquo;m creating this example project called <a href="https://github.com/malmstein/AndroidTVExplorer">Android TV Explorer</a> where all the knowledge from this series will be pushed.</p>

<p>By the end of this series the project will be a <strong>great starting point</strong> for anyone interested in developing a media library application for Android TV.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/AndroidTVExplorer/master/art/home.png"></p>

<h1>Creating a library layout using the Browse Fragment</h1>

<p>One of the widgets that the <code>Leanback Support Library</code> provides is the <a href="http://developer.android.com/reference/android/support/v17/leanback/app/BrowseFragment.html">BrowseFragment</a>.
A fragment for creating leanback browse screens, it is composed of a <code>RowsFragment</code> and a <code>HeadersFragment</code>.</p>

<p>As you can see in the library screen above, the header corresponds to the list on the left and the rows to the grid on the right. <code>BrowseFragment</code> allows us to customise several actions and some UI elements, like changing the default visibility of the <code>HeadersFragment</code> or changing the behaviour of the transition when entering one of the rows.</p>

<p>For the purpose of this example we are not going to change anything today, indeed we are going to
take a closer look at <strong>how the items are displayed</strong>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setupUIElements</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">setTitle</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">browse_title</span><span class="o">));</span>
</span><span class='line'>  <span class="n">setHeadersState</span><span class="o">(</span><span class="n">HEADERS_ENABLED</span><span class="o">);</span>
</span><span class='line'>  <span class="n">setHeadersTransitionOnBackEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>  <span class="n">setBrandColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">fastlane_background</span><span class="o">));</span>
</span><span class='line'>  <span class="n">setSearchAffordanceColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">search_opaque</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There several helper methods that the <code>BrowseFragment</code> exposes that make it very simple to customise its look and feel. For example, <code>setBrandColor()</code> and <code>setSearchAffordanceColor()</code> allow us to change the background of the <code>HeadersFragment</code> and the color of the rounded search icon.</p>

<h1>Presenter</h1>

<p><code>BrowseFragment</code> renders the elements of its <a href="http://developer.android.com/reference/android/support/v17/leanback/widget/ArrayObjectAdapter.html">ArrayObjectAdapter</a> as a sequence of rows and a vertical list. This <code>ObjectAdapter</code> makes use of a <a href="http://developer.android.com/reference/android/support/v17/leanback/widget/Presenter.html">Presenter</a>, concept which those familiar with the <a href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93presenter">Model-view-presenter</a> will quickly understand.</p>

<p>A <code>Presenter</code> is used to generate <code>Views</code> and bind <code>Objects</code> to them on demand. It is closely related to concept of an <code>RecyclerView.Adapter</code>, but is non position-based.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoadFinished</span><span class="o">(</span><span class="n">Loader</span><span class="o">&lt;</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;&gt;&gt;</span> <span class="n">arg0</span><span class="o">,</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;&gt;</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">mRowsAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ArrayObjectAdapter</span><span class="o">(</span><span class="k">new</span> <span class="nf">ListRowPresenter</span><span class="o">());</span>
</span><span class='line'>  <span class="n">CardPresenter</span> <span class="n">cardPresenter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">CardPresenter</span><span class="o">();</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">data</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">ArrayObjectAdapter</span> <span class="n">listRowAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ArrayObjectAdapter</span><span class="o">(</span><span class="n">cardPresenter</span><span class="o">);</span>
</span><span class='line'>      <span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">listRowAdapter</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">));</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="n">HeaderItem</span> <span class="n">header</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">HeaderItem</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>      <span class="n">i</span><span class="o">++;</span>
</span><span class='line'>      <span class="n">mRowsAdapter</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">ListRow</span><span class="o">(</span><span class="n">header</span><span class="o">,</span> <span class="n">listRowAdapter</span><span class="o">));</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">setAdapter</span><span class="o">(</span><span class="n">mRowsAdapter</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We are using a <code>CardPresenter</code> which will <strong>display all the movies from each category into cards</strong>. The elements of the <code>BrowseFragment</code> adapter must be subclasses of &lsquo;Row&rsquo;, that&rsquo;s the reason why the <code>mRowsAdapter</code> uses the <code>ListRowPresenter</code>. Again, this is just a wrapper around normal fragments and its goal is to make things easy to develop from scratch. Obviously, one can make use of them or not but for the purpose of this project we&rsquo;ll stick to the simplicity&hellip; for now!</p>

<h1>Setting up event listeners</h1>

<p>There are two exposed <code>Listeners</code> in the <code>BrowseFragment</code>. It&rsquo;s very interesting to see
how the selection and click are two different events, the reason why is very simple and you&rsquo;ll get
to understand it after reading the code.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>
</span><span class='line'><span class="kd">protected</span> <span class="n">OnItemViewSelectedListener</span> <span class="nf">getDefaultItemSelectedListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">new</span> <span class="nf">OnItemViewSelectedListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onItemSelected</span><span class="o">(</span><span class="n">Presenter</span><span class="o">.</span><span class="na">ViewHolder</span> <span class="n">viewHolder</span><span class="o">,</span> <span class="n">Object</span> <span class="n">item</span><span class="o">,</span> <span class="n">RowPresenter</span><span class="o">.</span><span class="na">ViewHolder</span>                  <span class="n">viewHolder2</span><span class="o">,</span> <span class="n">Row</span> <span class="n">row</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mBackgroundURI</span> <span class="o">=</span> <span class="o">((</span><span class="n">Movie</span><span class="o">)</span> <span class="n">item</span><span class="o">).</span><span class="na">getBackgroundImageURI</span><span class="o">();</span>
</span><span class='line'>      <span class="n">updateBackgroundPicture</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">};</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">protected</span> <span class="n">OnItemViewClickedListener</span> <span class="nf">getDefaultItemClickedListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">new</span> <span class="nf">OnItemViewClickedListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onItemClicked</span><span class="o">(</span><span class="n">Presenter</span><span class="o">.</span><span class="na">ViewHolder</span> <span class="n">viewHolder</span><span class="o">,</span> <span class="n">Object</span> <span class="n">item</span><span class="o">,</span> <span class="n">RowPresenter</span><span class="o">.</span><span class="na">ViewHolder</span> <span class="n">viewHolder2</span><span class="o">,</span> <span class="n">Row</span> <span class="n">row</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="n">movie</span><span class="o">.</span><span class="na">getTitle</span><span class="o">(),</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">};</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When a video is selected we can use the <a href="https://developer.android.com/reference/android/support/v17/leanback/app/BackgroundManager.html">BackgroundManager</a> to update the background picture.</p>

<h1>Background Manager</h1>

<p>This is a complete different approach to what a mobile or tablet application would do but in my honest opinion makes a lot of sense. <strong>Android TV supports background image continuity between multiple <code>Activities</code></strong>.
We are used to have transitions between all the <code>Activities</code> but this can be confusing in bigger form factors and when there is not a context switch, making use of the <code>Background Manager</code> we can deliver smoother transitions that won&rsquo;t disturb the user when looking at a big screen.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updateBackground</span><span class="o">(</span><span class="n">Drawable</span> <span class="n">drawable</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">BackgroundManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">getActivity</span><span class="o">()).</span><span class="na">setDrawable</span><span class="o">(</span><span class="n">drawable</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Tip</h2>

<p>Setting up the environment might be a bit tricky when talking about Android TV. Some of you may have an
<a href="http://developer.android.com/tv/adt-1/index.html">ADT Developer Kit</a> but if you don&rsquo;t you&rsquo;ll need to create
an emulator to start with (or wait for the brand new Nexus Player). It&rsquo;s pretty straight forward to <a href="http://developer.android.com/training/tv/start/start.html#run">create an emulator</a> but it&rsquo;s very helpful to activate
<a href="http://developer.android.com/tools/devices/emulator.html#acceleration">hardware acceleration</a> in order to
have better performance in the Android TV emulator.</p>

<h1>Show me the code</h1>

<p>You&rsquo;ll find the entire project on <a href="https://github.com/malmstein/AndroidTVExplorer">Github</a> and I&rsquo;ll be adding
more features along with all the blog posts of this series. As always, all <del>trolling</del> feedback is more than welcome!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[All Your Gestures Belong to Fenster]]></title>
    <link href="http://malmstein.github.io/blog/2014/10/11/all-your-gestures-belong-to-fenster/"/>
    <updated>2014-10-11T14:12:51+01:00</updated>
    <id>http://malmstein.github.io/blog/2014/10/11/all-your-gestures-belong-to-fenster</id>
    <content type="html"><![CDATA[<p>In the <a href="www.malmstein.com/blog/2014/09/21/control-the-media-player-using-gestures/">previous post</a>
we showed how to implement some basic gestures and control the <code>MediaPlayer</code>.</p>

<p>Today we are going a step further by implementing multitouch gestures. So far we can
control the progress of a video but that&rsquo;s not enough. If we want full control over the
<code>MediaPlayer</code> we need to be able to change the volume, adjust the brightness and skip the
video forward and backwards.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/fenster/master/art/multitouch.gif"></p>

<!-- more -->


<p>The <code>MediaPlayerController</code> source code is getting bigger and bigger so it&rsquo;s very important to keep
things as reusable and clean as possible. For that reason, tasks like update the volume
or adjusting the brightness can be done from their own components, in these case, <a href="http://developer.android.com/reference/android/widget/SeekBar.html">SeekBar</a>.</p>

<p>With these new <code>Views</code>, one will be able to just import and use these small controllers without having
to import the whole <code>MediaPlayerController</code>, just trying to make things easy here!</p>

<h1>Volume SeekBar</h1>

<p>Taking advantage of the gestures, we are also going to update the volume&hellip; how do we do that?
There is now a new component in <a href="https://github.com/malmstein/fenster">Fenster</a> called <a href="https://github.com/malmstein/fenster">VolumeSeekBar</a>,
a <code>SeekBar</code> which updates the volume of the <a href="http://developer.android.com/reference/android/media/AudioManager.html">AudioManager</a>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialise</span><span class="o">(</span><span class="kd">final</span> <span class="n">Listener</span> <span class="n">volumeListener</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">audioManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">AudioManager</span><span class="o">)</span> <span class="n">getContext</span><span class="o">().</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">AUDIO_SERVICE</span><span class="o">);</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">volumeListener</span> <span class="o">=</span> <span class="n">volumeListener</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">setMax</span><span class="o">(</span><span class="n">audioManager</span><span class="o">.</span><span class="na">getStreamMaxVolume</span><span class="o">(</span><span class="n">AudioManager</span><span class="o">.</span><span class="na">STREAM_MUSIC</span><span class="o">));</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">setProgress</span><span class="o">(</span><span class="n">audioManager</span><span class="o">.</span><span class="na">getStreamVolume</span><span class="o">(</span><span class="n">AudioManager</span><span class="o">.</span><span class="na">STREAM_MUSIC</span><span class="o">));</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">setOnSeekBarChangeListener</span><span class="o">(</span><span class="n">volumeSeekListener</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here you can see the public method to initialise the <code>View</code>, the only thing we need to pass is
the <code>Listener</code> which will notify when the view is being dragged.</p>

<p>The <code>AudioManager</code> is the object which is in charge of the volume, <code>setStreamVolume()</code> is the
method which is exposed for that matter. Since we want to update them based on the changes
on the <code>SeekBar</code>, the <code>SeekBarChangeListener</code> is the way we want to go.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">final</span> <span class="n">OnSeekBarChangeListener</span> <span class="n">volumeSeekListener</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">OnSeekBarChangeListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProgressChanged</span><span class="o">(</span><span class="n">SeekBar</span> <span class="n">seekBar</span><span class="o">,</span> <span class="kt">int</span> <span class="n">vol</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">fromUser</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">audioManager</span><span class="o">.</span><span class="na">setStreamVolume</span><span class="o">(</span><span class="n">AudioManager</span><span class="o">.</span><span class="na">STREAM_MUSIC</span><span class="o">,</span> <span class="n">vol</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStartTrackingTouch</span><span class="o">(</span><span class="n">SeekBar</span> <span class="n">seekBar</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">volumeListener</span><span class="o">.</span><span class="na">onVolumeStartedDragging</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStopTrackingTouch</span><span class="o">(</span><span class="n">SeekBar</span> <span class="n">seekBar</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">volumeListener</span><span class="o">.</span><span class="na">onVolumeFinishedDragging</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, we are also notifying the root controller that some dragging is going on.
This will be used in order to prevent the controller from being hidden while the user is
dragging the <code>Seekbar</code>.</p>

<p>We can&rsquo;t forget about the <strong>hardware keys</strong>, if we don&rsquo;t listen for updates on those keys
we&rsquo;ll be out of sync. Don&rsquo;t worry, we got this covered too.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onAttachedToWindow</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">super</span><span class="o">.</span><span class="na">onAttachedToWindow</span><span class="o">();</span>
</span><span class='line'>  <span class="n">getContext</span><span class="o">().</span><span class="na">registerReceiver</span><span class="o">(</span><span class="n">volumeReceiver</span><span class="o">,</span>
</span><span class='line'>    <span class="k">new</span> <span class="nf">IntentFilter</span><span class="o">(</span><span class="s">&quot;android.media.VOLUME_CHANGED_ACTION&quot;</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDetachedFromWindow</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">unregisterVolumeReceiver</span><span class="o">();</span>
</span><span class='line'>  <span class="n">getContext</span><span class="o">().</span><span class="na">unregisterReceiver</span><span class="o">(</span><span class="n">volumeReceiver</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="n">BroadcastReceiver</span> <span class="n">volumeReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">BroadcastReceiver</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">setProgress</span><span class="o">(</span><span class="n">audioManager</span><span class="o">.</span><span class="na">getStreamVolume</span><span class="o">(</span><span class="n">AudioManager</span><span class="o">.</span><span class="na">STREAM_MUSIC</span><span class="o">));</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can use a <a href="http://developer.android.com/reference/android/content/BroadcastReceiver.html">BroadcastReceiver</a>
which alerts us when the volume has changed via hardware keys. We are going to make us of the view lifecycle
in order to register and unregister and update the <code>SeekBar</code> progress.</p>

<h1>Brightness SeekBar</h1>

<p>Another interesting feature of any <code>MediaPlayer</code> is to adjust the screen brightness.
Currently, Android doesn&rsquo;t make it to easy for the user to do so and that&rsquo;s where <a href="https://github.com/malmstein/fenster">Fenster</a> comes in.</p>

<p>The screen brightness is a <a href="http://developer.android.com/reference/android/provider/Settings.System.html#SCREEN_BRIGHTNESS">System Setting</a>
that goes from 0 to 255. In order to change it, we just need to update the system setting with its new value.</p>

<p>Since we want to make it easy and modular, there is now a new class which will handle the
brightness update, the <a href="https://github.com/malmstein/fenster/blob/master/library/src/main/java/com/malmstein/fenster/helper/BrightnessHelper.java">BrightnessHelper</a>.
It just exposes a static method which needs a <code>Context</code> and the integer value with the new brightness.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setBrightness</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">int</span> <span class="n">brightness</span><span class="o">){</span>
</span><span class='line'>  <span class="n">ContentResolver</span> <span class="n">cResolver</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getContentResolver</span><span class="o">();</span>
</span><span class='line'>  <span class="n">Settings</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="n">cResolver</span><span class="o">,</span> <span class="n">Settings</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">SCREEN_BRIGHTNESS</span><span class="o">,</span> <span class="n">brightness</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our approach is to use a <code>SeekBar</code>, similar as the <code>VolumeSeekBar</code> one. For that purpose, and in order make things more interactive
to the user, we&rsquo;ll use a <code>SeekBarChangeListener</code> to update the brightness meanwhile the <code>SeekBar</code> progress changes.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">final</span> <span class="n">OnSeekBarChangeListener</span> <span class="n">brightnessSeekListener</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">OnSeekBarChangeListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProgressChanged</span><span class="o">(</span><span class="n">SeekBar</span> <span class="n">seekBar</span><span class="o">,</span> <span class="kt">int</span> <span class="n">brightness</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">fromUser</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">setBrightness</span><span class="o">(</span><span class="n">brightness</span><span class="o">);</span>
</span><span class='line'>    <span class="n">setProgress</span><span class="o">(</span><span class="n">brightness</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStartTrackingTouch</span><span class="o">(</span><span class="n">SeekBar</span> <span class="n">seekBar</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">brightnessListener</span><span class="o">.</span><span class="na">onBrigthnessStartedDragging</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStopTrackingTouch</span><span class="o">(</span><span class="n">SeekBar</span> <span class="n">seekBar</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">brightnessListener</span><span class="o">.</span><span class="na">onBrightnessFinishedDragging</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">};</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Skipping the video</h2>

<p>The video skipping is pretty straight forward since the timeframe we are going to skip the video
forward or backwards is fixed. We just need to update the <code>SeekBar</code> progress:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">skipVideoForward</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">skipUnit</span> <span class="o">=</span> <span class="n">mProgress</span><span class="o">.</span><span class="na">getProgress</span><span class="o">()</span> <span class="o">+</span> <span class="n">SKIP_VIDEO_PROGRESS</span><span class="o">;</span>
</span><span class='line'>    <span class="n">mSeekListener</span><span class="o">.</span><span class="na">onProgressChanged</span><span class="o">(</span><span class="n">mProgress</span><span class="o">,</span> <span class="n">skipUnit</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>How the Controller updates it all</h1>

<p>As a recap from the past blog post and this very same one, we are now able to detect gestures like
horizontal or vertical scrolls and horizontal or vertical flings. On the other hand, we also have
now two <code>Views</code> that can update the volume and the brightness so&hellip; let&rsquo;s put all that
together.</p>

<p>What we are going to do is to <strong>update the video progress</strong> when scroll or fling movements occur
and only <strong>one finger</strong> is being used to make the gesture. When <strong>two or more fingers</strong> are being used we
will <strong>adjust the screen brightness or the volume</strong>.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/Fenster/master/art/multitouch.gif"></p>

<p>How do we do that?</p>

<p><a href="http://developer.android.com/reference/android/view/MotionEvent.html">MotionEvent</a> already tells us
how many pointers are being used, that&rsquo;s basically telling us how many fingers are triggering the
event.</p>

<p>When a gesture with horizontal progress is detected we&rsquo;ll react on the video progress. One finger
for small updates and two fingers for skipping 30 seconds backwards or forwards. The delta parameter
tells us is the direction of the movement is right or left.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onHorizontalScroll</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">,</span> <span class="kt">float</span> <span class="n">delta</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getPointerCount</span><span class="o">()</span> <span class="o">==</span> <span class="n">ONE_FINGER</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">updateVideoProgressBar</span><span class="o">(</span><span class="n">delta</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">skipVideoForward</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">skipVideoBackwards</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When the movement is vertical, we&rsquo;ll update the volume and the brightness. One finger for the
volume and two or more for the brightness.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onVerticalScroll</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">,</span> <span class="kt">float</span> <span class="n">delta</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getPointerCount</span><span class="o">()</span> <span class="o">==</span> <span class="n">ONE_FINGER</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">updateVolumeProgressBar</span><span class="o">(</span><span class="n">delta</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">updateBrightnessProgressBar</span><span class="o">(</span><span class="n">delta</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Translating the gesture to the view</h1>

<p>The approach is to translate the gestures on top the of <code>FensterGestureControllerView</code> into the
seekbars. Ideally, when making a gesture across the whole width or height of the <code>View</code> we&rsquo;ll
be also updating the <code>Seekbar</code> through it&rsquo;s whole range.</p>

<p>To do so, we need to use the movement delta and apply a scale to the <code>Seekbar</code>. Of course, we
also need to take into account the <strong>max</strong> value of the <code>Seekbar</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">int</span> <span class="nf">extractDeltaScale</span><span class="o">(</span><span class="kt">int</span> <span class="n">availableSpace</span><span class="o">,</span> <span class="kt">float</span> <span class="n">deltaX</span><span class="o">,</span> <span class="n">SeekBar</span> <span class="n">seekbar</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">deltaX</span><span class="o">;</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">scale</span><span class="o">;</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">progress</span> <span class="o">=</span> <span class="n">seekbar</span><span class="o">.</span><span class="na">getProgress</span><span class="o">();</span>
</span><span class='line'>    <span class="kd">final</span> <span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="n">seekbar</span><span class="o">.</span><span class="na">getMax</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">scale</span> <span class="o">=</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="o">-</span> <span class="n">availableSpace</span><span class="o">);</span>
</span><span class='line'>        <span class="n">progress</span> <span class="o">=</span> <span class="n">progress</span> <span class="o">-</span> <span class="o">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">progress</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">scale</span> <span class="o">=</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="n">availableSpace</span><span class="o">;</span>
</span><span class='line'>        <span class="n">progress</span> <span class="o">+=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">max</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">progress</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <strong>available space</strong> corresponds to the size of the <code>FensterGestureControllerView</code>. The width
if the movement is horizontal or the height in case it&rsquo;s a vertical movement.</p>

<h1>Next steps</h1>

<p>There is still much to do with <code>Fenster</code>. I&rsquo;ll be adding some ideas to the GitHub repo, please feel
free to <a href="https://github.com/malmstein/fenster/issues">add your own requests</a> or even implement
them yourselves!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Gestures to Control the Media Player]]></title>
    <link href="http://malmstein.github.io/blog/2014/09/21/control-the-media-player-using-gestures/"/>
    <updated>2014-09-21T19:24:59+01:00</updated>
    <id>http://malmstein.github.io/blog/2014/09/21/control-the-media-player-using-gestures</id>
    <content type="html"><![CDATA[<p>In the previous post we explained a way of displaying a <a href="http://www.malmstein.com/blog/2014/08/09/how-to-use-a-textureview-to-display-a-video-with-custom-media-player-controls">customised Media Player controller</a>,
which as we saw, it&rsquo;s very useful if we need customised actions or UI for that controller.</p>

<p>This time we want to go a step forward and introduce a new way of interacting with the Media Player.
The idea is to use gestures in order to lower or raise the volume, seek forward and backwards
and to skip the video for 30 seconds.</p>

<p>I&rsquo;m a big fan of <a href="https://play.google.com/store/apps/details?id=com.mxtech.videoplayer.ad">MX Player</a> and
always wanted to implement the gesture detection that they introduced.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/Fenster/master/art/fenster_gesture.gif"></p>

<!-- more -->


<p>In order to achieve this, the first thing we need to understand is how the gestures
are detected and how we can use them in our benefit.</p>

<p>When one or more fingers are placed on the screen, the callback <code>onTouchEvent()</code> is triggered on
the View that received the touch events. What&rsquo;s important here is to understand that a gesture
is a sequence of touch events and each one of them will fire <code>onTouchEvent()</code>.</p>

<p>A gesture starts when the user first touches the screen, continues as the system tracks the
position of the user&rsquo;s finger(s), and ends by capturing the final event of the user&rsquo;s fingers
leaving the screen. Throughout this interaction, the <a href="http://developer.android.com/reference/android/view/MotionEvent.html">MotionEvent</a>
delivered to <code>onTouchEvent()</code> provides the details of every interaction.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/Fenster/master/art/basic_multitouch.gif"></p>

<h2>Understanding MotionEvent</h2>

<p>Android uses <code>MotionEvent</code> to report movements, providing an action and a set of axis values. <strong>Each action
describes the state change occurred</strong>, such as pointer going down, up or moving. Another very important
aspect of <code>MotionEvent</code> is that not only describes one movement but can also <strong>describe multi-touch events</strong>.
This is particularly important if we are trying to identify multi-touch gestures such as
scrolling with two fingers or two finger double tap.</p>

<h2>Gesture Detector</h2>

<p>Now that we know how events are described on Android, it&rsquo;s time to understand how gestures are
detected and how to apply it to our purpose. For that matter, Android provides the
<a href="http://developer.android.com/reference/android/view/GestureDetector.html">GestureDetector</a></p>

<p>There are two different ways of intercepting gestures on Android. One can use
the <a href="http://developer.android.com/reference/android/view/GestureDetector.SimpleOnGestureListener.html">SimpleGestureListener</a> class,
which wraps around the interfaces <a href="http://developer.android.com/reference/android/view/GestureDetector.OnGestureListener.html">OnGestureListener</a>
and <a href="http://developer.android.com/reference/android/view/GestureDetector.OnDoubleTapListener.html">OnDoubleTapListener</a>.
Think about it as a convenience class to extend when you only want to listen for a subset
of all the gestures.</p>

<p>The other approach is to implement the interfaces that are more interesting to you, since
we here to play, that&rsquo;s the one we’ll follow.</p>

<p>As you can see there are several events that we can intercept:</p>

<ul>
<li> <code>onDown()</code> : Notified when a tap occurs with the event that triggered it. This will be triggered immediately for every down event. All other events should be preceded by this.</li>
<li> <code>onShowPress()</code>: The user has performed a down {@link MotionEvent} and not performed a move or up yet.</li>
<li> <code>onSingleTapUp()</code>: Notified when a tap occurs with the up that triggered it.</li>
<li> <code>onScroll()</code>: Notified when a scroll occurs with the initial on down and the current move. The distance in x and y is also supplied for convenience.</li>
<li> <code>onLongPress()</code>: Notified when a long press occurs with the initial on down that trigged it.</li>
<li> <code>onFling()</code>: Notified of a fling event when it occurs with the initial on down and the matching up. The calculated velocity is supplied along the x and y axis in pixels per second.</li>
</ul>


<p><img src="https://raw.githubusercontent.com/malmstein/Fenster/master/art/basic_gesture.gif"></p>

<h2>The Gesture View</h2>

<p>Now that we have all the tools and we understand how this whole thing works, let&rsquo;s get our hands
dirty. Our approach will be to add a <code>View</code> to our <code>PlayerController</code>, this view will handle
all the gestures and delegate the interaction of those to the <code>PlayerController</code>.</p>

<p>All we need to do here is to send all the intercepted events coming from the
<code>FensterGestureControllerView</code> to the <code>GestureDetector</code> via the <code>onTouchEvent()</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">gestureDetector</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As we said earlier, the <code>GestureDetector</code> is the one in charge of detecting all these events, in
combination with the &lsquo;GestureListener&rsquo;</p>

<h2>The Gesture and Events listeners</h2>

<p>We are only interested in some of the gestures that can be detected, in our case it&rsquo;s all described
in the following interface</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">FensterEventsListener</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">onTap</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">onHorizontalScroll</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">,</span> <span class="kt">float</span> <span class="n">delta</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">onVerticalScroll</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">,</span> <span class="kt">float</span> <span class="n">delta</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">onSwipeRight</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">onSwipeLeft</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">onSwipeBottom</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">onSwipeTop</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once we detect one of these events, the <code>MediaPlayerController</code> will react by changing the
progress bar, raising the volume or skipping. Pretty straight forward right? Let&rsquo;s actually see
where the magic happens, the gesture detection.</p>

<p>As said earlier, the <a href="http://developer.android.com/reference/android/view/GestureDetector.OnGestureListener.html">OnGestureListener</a>
provides the interfaces we are interested in, let&rsquo;s start by detecting the <strong>Horizontal</strong> and <strong>Vertical</strong> scrolls.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onScroll</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">e1</span><span class="o">,</span> <span class="n">MotionEvent</span> <span class="n">e2</span><span class="o">,</span> <span class="kt">float</span> <span class="n">distanceX</span><span class="o">,</span> <span class="kt">float</span> <span class="n">distanceY</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Scroll&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">float</span> <span class="n">deltaY</span> <span class="o">=</span> <span class="n">e2</span><span class="o">.</span><span class="na">getY</span><span class="o">()</span> <span class="o">-</span> <span class="n">e1</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
</span><span class='line'>        <span class="kt">float</span> <span class="n">deltaX</span> <span class="o">=</span> <span class="n">e2</span><span class="o">.</span><span class="na">getX</span><span class="o">()</span> <span class="o">-</span> <span class="n">e1</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">deltaX</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">deltaY</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">deltaX</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">SWIPE_THRESHOLD</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">listener</span><span class="o">.</span><span class="na">onHorizontalScroll</span><span class="o">(</span><span class="n">e2</span><span class="o">,</span> <span class="n">deltaX</span><span class="o">);</span>
</span><span class='line'>                <span class="k">if</span> <span class="o">(</span><span class="n">deltaX</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Slide right&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Slide left&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">deltaY</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">SWIPE_THRESHOLD</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">listener</span><span class="o">.</span><span class="na">onVerticalScroll</span><span class="o">(</span><span class="n">e2</span><span class="o">,</span> <span class="n">deltaY</span><span class="o">);</span>
</span><span class='line'>                <span class="k">if</span> <span class="o">(</span><span class="n">deltaY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Slide down&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Slide up&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>onScroll()</code> interface provides the initial on down <code>MotionEvent</code> and the current one, using
the axis values we can detect the direction towards where the scrolling movement is going
and calculate the delta of the movement.</p>

<p>Note the threshold value, that needs to be there in order to filter movements. We don&rsquo;t want to
be confused with small movements or flings, only the gestures which have moved a certain
distance can be considered as scrolls.</p>

<p>It&rsquo;s also important to understand the difference between scrolls and flings since they are also
going to be treated differently. A <strong>scroll is a continuos movement</strong> like the one you&rsquo;ll use to
navigate through a timeline, as opposed to a <strong>fling which is intentionally a short and fast movement</strong>
which one will use to navigate horizontally through a view pager.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onFling</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">e1</span><span class="o">,</span> <span class="n">MotionEvent</span> <span class="n">e2</span><span class="o">,</span> <span class="kt">float</span> <span class="n">velocityX</span><span class="o">,</span> <span class="kt">float</span> <span class="n">velocityY</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// Fling event occurred.  Notification of this one happens after an &quot;up&quot; event.</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Fling&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="kt">float</span> <span class="n">diffY</span> <span class="o">=</span> <span class="n">e2</span><span class="o">.</span><span class="na">getY</span><span class="o">()</span> <span class="o">-</span> <span class="n">e1</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
</span><span class='line'>            <span class="kt">float</span> <span class="n">diffX</span> <span class="o">=</span> <span class="n">e2</span><span class="o">.</span><span class="na">getX</span><span class="o">()</span> <span class="o">-</span> <span class="n">e1</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">diffX</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">diffY</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">diffX</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">SWIPE_THRESHOLD</span> <span class="o">&amp;&amp;</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">velocityX</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">minFlingVelocity</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                    <span class="k">if</span> <span class="o">(</span><span class="n">diffX</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                        <span class="n">listener</span><span class="o">.</span><span class="na">onSwipeRight</span><span class="o">();</span>
</span><span class='line'>                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                        <span class="n">listener</span><span class="o">.</span><span class="na">onSwipeLeft</span><span class="o">();</span>
</span><span class='line'>                    <span class="o">}</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>                <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">diffY</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">SWIPE_THRESHOLD</span> <span class="o">&amp;&amp;</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">velocityY</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">minFlingVelocity</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="o">(</span><span class="n">diffY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">listener</span><span class="o">.</span><span class="na">onSwipeBottom</span><span class="o">();</span>
</span><span class='line'>                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">listener</span><span class="o">.</span><span class="na">onSwipeTop</span><span class="o">();</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">exception</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">exception</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There is a new constant introduced here, the <code>minFlingVelocity</code>. Since the fling is considered to
be a fast movement, we need to make sure that the motion event velocity is fast enough.</p>

<p>How do we get these constant values? Android conveniently has a  <a href="" title="http://developer.android.com/reference/android/view/ViewConfiguration.html">ViewConfiguration</a>
class with standard constants used in the UI for timeouts, sizes, and distances.</p>

<h2>The Controller View</h2>

<p>Ultimately, it will be the player controller the guy who will react to the events.
That&rsquo;s why we delegate all the responsibility to the gesture listener. We attach the listener
from the player controller to the listener like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFensterEventsListener</span><span class="o">(</span><span class="n">FensterEventsListener</span> <span class="n">listener</span><span class="o">){</span>
</span><span class='line'>        <span class="n">gestureDetector</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GestureDetector</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span>
</span><span class='line'>                          <span class="k">new</span> <span class="nf">FensterGestureListener</span><span class="o">(</span><span class="n">listener</span><span class="o">,</span>
</span><span class='line'>                              <span class="n">ViewConfiguration</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">getContext</span><span class="o">())));</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Acting on the Media Player</h2>

<p>Finally, we have all the pieces together. We are now able to detect when the user is touching
the screen and we can also detect the type of gesture that is happening.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onHorizontalScroll</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">,</span> <span class="kt">float</span> <span class="n">delta</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">updateVideoProgressBar</span><span class="o">(</span><span class="n">delta</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">updateVideoProgressBar</span><span class="o">(</span><span class="kt">float</span> <span class="n">delta</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mSeekListener</span><span class="o">.</span><span class="na">onProgressChanged</span><span class="o">(</span><span class="n">mProgress</span><span class="o">,</span>
</span><span class='line'>            <span class="n">extractHorizontalDeltaScale</span><span class="o">(</span><span class="n">delta</span><span class="o">,</span> <span class="n">mProgress</span><span class="o">),</span> <span class="kc">true</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For this first attempt we will only act on the video progress bar, which is a pretty straigh
forward thing to do since we already have a <code>seekListener</code> which acts on the media player. The
only thing we need to do is scaling the user movement compared to the <a href="" title="http://developer.android.com/reference/android/widget/SeekBar.html">SeekBar</a>.</p>

<p>The interface is giving us a <strong>delta</strong>, which is the amount of pixels of the gesture. We are
taking as reference the whole <code>View</code> width, that way when the user scrolls the whole width of
the screen it will also seek through the whole video in a 1:1 scale. The last thing we
need to take into consideration the <strong>MAX</strong> parameter applied to the <code>SeekBar</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">extractDeltaScale</span><span class="o">(</span><span class="kt">int</span> <span class="n">availableSpace</span><span class="o">,</span> <span class="kt">float</span> <span class="n">deltaX</span><span class="o">,</span> <span class="n">SeekBar</span> <span class="n">seekbar</span><span class="o">){</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">deltaX</span><span class="o">;</span>
</span><span class='line'>        <span class="kt">float</span> <span class="n">scale</span><span class="o">;</span>
</span><span class='line'>        <span class="kt">float</span> <span class="n">progress</span> <span class="o">=</span> <span class="n">seekbar</span><span class="o">.</span><span class="na">getProgress</span><span class="o">();</span>
</span><span class='line'>        <span class="kd">final</span> <span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="n">seekbar</span><span class="o">.</span><span class="na">getMax</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">// scrolling back</span>
</span><span class='line'>            <span class="n">scale</span> <span class="o">=</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="o">-</span> <span class="n">availableSpace</span><span class="o">)</span> <span class="o">;</span>
</span><span class='line'>            <span class="n">progress</span> <span class="o">=</span> <span class="n">progress</span> <span class="o">-</span> <span class="o">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">progress</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">// scrolling forwards</span>
</span><span class='line'>            <span class="n">scale</span> <span class="o">=</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="n">availableSpace</span><span class="o">;</span>
</span><span class='line'>            <span class="n">progress</span> <span class="o">+=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">max</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">progress</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once this is all computed we can now scroll back and forth across all the video timeline.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/Fenster/master/art/fenster_gesture.gif"></p>

<h2>Further reading</h2>

<p>If you want to experience further in detecting gestures and multitouch events, don’t
hesitate in importing two projects from the SDK samples: <code>BasicGestureDetect</code> and <code>BasicMultitouch</code>.
Yeah, they are basic, but it establishes the foundations of what we are going to do here.</p>

<p>There is also a pretty good training document about <a href="http://developer.android.com/training/gestures/detector.html">Gesture Detection</a> in
the Android Developer website.</p>

<h2>Fenster Library update</h2>

<p>In the next post we&rsquo;ll use the same techniques to act on several other aspects of the
<code>MediaPlayer</code>. In the meantime, the <a href="https://github.com/malmstein/fenster">Fenster</a> library has
been updated with all the parts of this post and the demo project also contains an example of
gesture detection against the <code>MediaPlayer</code>.</p>

<p>As always, all feedback received is more than welcome!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Use a TextureView to Display a Video With Custom Media Player Controls]]></title>
    <link href="http://malmstein.github.io/blog/2014/08/09/how-to-use-a-textureview-to-display-a-video-with-custom-media-player-controls/"/>
    <updated>2014-08-09T20:00:00+01:00</updated>
    <id>http://malmstein.github.io/blog/2014/08/09/how-to-use-a-textureview-to-display-a-video-with-custom-media-player-controls</id>
    <content type="html"><![CDATA[<p>For the past months at <a href="http://www.novoda.com">Novoda</a> I&rsquo;ve been working on several video applications <a href="https://play.google.com/store/apps/details?id=tv.arte.plus7">ARTE</a>,
<a href="https://play.google.com/store/apps/details?id=com.novoda.dch">Digital Concert Hall</a> and <a href="https://play.google.com/store/apps/details?id=com.mubi">MUBI</a>.</p>

<p>As you might figure by now, the common feature of these applications is to display a video with customised media player controls. I thought it would be
a good time to share some knowledge and show some ideas around video playing on Android. A couple of months ago I a <a href="https://speakerdeck.com/malmstein/streaming-the-droid">gave a talk</a>
 about it at <strong>Droidcon Berlin</strong> showing some code but I never had the proper amount of time to make it into a library.</p>

<!-- more -->


<h2>Media Player lifecycle</h2>

<p>The first thing we need to understand before playing videos or audio is the lifecycle of the <a href="http://developer.android.com/reference/android/media/MediaPlayer.html">Media Player</a></p>

<p><img src="http://developer.android.com/images/mediaplayer_state_diagram.gif"></p>

<p>As you see it&rsquo;s pretty straight forward, <strong>there are only 10 different states</strong>&hellip;</p>

<p>The most important piece of information that can be extracted from this diagram is that one needs to be very strict regarding the
behaviour of the <code>MediaPlayer</code>. It&rsquo;s very easy to follow the steps in the wrong order which will lead to frustration since debug information that the
<code>MediaPlayer</code> provides is pretty bad:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getErrorMessage</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">frameworkError</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">messageId</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">play_error_message</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">frameworkError</span> <span class="o">==</span> <span class="n">MediaPlayer</span><span class="o">.</span><span class="na">MEDIA_ERROR_IO</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;TextureVideoView error. File or network related operation errors.&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">frameworkError</span> <span class="o">==</span> <span class="n">MediaPlayer</span><span class="o">.</span><span class="na">MEDIA_ERROR_MALFORMED</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;TextureVideoView error. Bitstream is not conforming to the related coding standard or file spec.&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">frameworkError</span> <span class="o">==</span> <span class="n">MediaPlayer</span><span class="o">.</span><span class="na">MEDIA_ERROR_SERVER_DIED</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;TextureVideoView error. Media server died. In this case, the application must release the MediaPlayer object and instantiate a new one.&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">frameworkError</span> <span class="o">==</span> <span class="n">MediaPlayer</span><span class="o">.</span><span class="na">MEDIA_ERROR_TIMED_OUT</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;TextureVideoView error. Some operation takes too long to complete, usually more than 3-5 seconds.&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">frameworkError</span> <span class="o">==</span> <span class="n">MediaPlayer</span><span class="o">.</span><span class="na">MEDIA_ERROR_UNKNOWN</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;TextureVideoView error. Unspecified media player error.&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">frameworkError</span> <span class="o">==</span> <span class="n">MediaPlayer</span><span class="o">.</span><span class="na">MEDIA_ERROR_UNSUPPORTED</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;TextureVideoView error. Bitstream is conforming to the related coding standard or file spec, but the media framework does not support the feature.&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">frameworkError</span> <span class="o">==</span> <span class="n">MediaPlayer</span><span class="o">.</span><span class="na">MEDIA_ERROR_NOT_VALID_FOR_PROGRESSIVE_PLAYBACK</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;TextureVideoView error. The video is streamed and its container is not valid for progressive playback i.e the video&#39;s index (e.g moov atom) is not at the start of the file.&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">messageId</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">play_progressive_error_message</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">messageId</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This information can be accessed using two different listeners from the <code>MediaPlayer</code>, <a href="http://developer.android.com/reference/android/media/MediaPlayer.OnInfoListener.html">onInfoListener</a>
and <a href="http://developer.android.com/reference/android/media/MediaPlayer.OnErrorListener.html">onErrorListener</a>. We are learning all this before actually displaying
any content, and you thought this was going to be easy!</p>

<p>Now we understand how the <code>MediaPlayer</code> works, the next step is to decide how are we going to display the video, what <code>View</code> are we going to use?</p>

<h2>TextureView vs SurfaceView</h2>

<p>The easiest way of displaying a video in Android is using a <a href="http://developer.android.com/reference/android/widget/VideoView.html">VideoView</a>. With very few
lines of code you&rsquo;ll be able to display a video from a local source or from the internet and it will just play. <strong>This is a very good approach if you
don&rsquo;t need any fancy stuff</strong>, no customisation or no callbacks. In our case, customisation was needed hence callbacks were needed and this solution was simply
just not good enough.</p>

<p>In the first place my thought was to extend <code>VideoView</code> and add some functionality but if you&rsquo;ve checked the <a href="https://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/core/java/android/widget/VideoView.java">source code</a>,
<code>VideoView</code> is extending <code>SurfaceView</code> and that has some limitations and constraints. <code>SurfaceView</code> provides a dedicated drawing surface embedded inside of a view hierarchy,
the layout of which can be defined, in size and format. It also takes care of placing the surface at the correct location on the screen.</p>

<p>The main limitation is that <strong>SurfaceView can&rsquo;t be animated, moved or transformed</strong>, that&rsquo;s because it&rsquo;s created in a separate window and not
treated as a <code>View</code>. That was a big problem considering what we wanted to achieve so we turned our eyes
towards <a href="http://developer.android.com/reference/android/view/TextureView.html">TextureView</a>.</p>

<p>It&rsquo;s not all bad news for <code>SurfaceView</code>, <strong>Chrome</strong> used to use <code>TextureView</code> as the compositor target surface but they went back to using
<code>SurfaceView</code>. These are the main reasons:</p>

<ul>
<li>Because of its invalidation and buffering behaviour, TextureView adds 1-3 extra frames of latency to display updates.</li>
<li>TextureView is always composited using GL, whereas SurfaceTexture can be backed by a hardware overlay which uses less memory bandwidth and power.</li>
<li>The internal buffer queue of TextureView can end up using more memory than a SurfaceView.</li>
<li>We weren&rsquo;t really doing anything useful with the animation and transform capabilities of TextureView.</li>
</ul>


<p>Full discussion in Google Groups can be found <a href="https://groups.google.com/a/chromium.org/forum/#!topic/graphics-dev/Z0yE-PWQXc4">here</a></p>

<p>We wanted to transform and animate that view so our choice was already made.</p>

<h2>Custom Controls</h2>

<p>So the video is going to be displayed in a <code>TextureView</code>, now we need a way of interacting with the video. Yes, the media player controls.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/Fenster/master/art/custom_controls.png"></p>

<p>As you can see we decided to use a similar approach to what <strong>Youtube</strong> is doing, the custom controller occupies the whole screen making it very easy to use.
Quite frankly this is much more appealing from my point of view. We&rsquo;ve all seen these designs for video players where the controller is aligned to the
bottom of the screen (inspired in certain other platform) and I certainly believe this approach makes more sense.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;com.malmstein.fenster.VideoTouchRoot</span>
</span><span class='line'>  <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>  <span class="na">android:id=</span><span class="s">&quot;@+id/media_controller_touch_root&quot;</span>
</span><span class='line'>  <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>  <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>  <span class="na">android:background=</span><span class="s">&quot;@color/default_bg&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>....
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/com.malmstein.fenster.VideoTouchRoot&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The most important part of this custom controller is <strong>the root layout which is going to enable / disable the controller itself</strong>. That is the <code>VideoTouchRoot</code> and
it&rsquo;s nothing else than a <code>FrameLayout</code> we put as a layout root to get notified about any screen touches. The <code>PlayerController</code> will set a listener and show or
hide the view accordingly</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">VideoTouchRoot</span> <span class="n">touchRoot</span> <span class="o">=</span> <span class="o">(</span><span class="n">VideoTouchRoot</span><span class="o">)</span> <span class="n">v</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">media_controller_touch_root</span><span class="o">);</span>
</span><span class='line'><span class="n">touchRoot</span><span class="o">.</span><span class="na">setOnTouchReceiver</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>How does the PlayerController work?</strong></p>

<p>Basically, the big part of the job is done when the <code>PlayerController</code> needs to be attached. It&rsquo;s the <code>TextureView</code> who takes care of this job, setting an anchor
view which is the <code>PlayerController</code> itself.</p>

<p>Once this view is anchored it&rsquo;s just a matter of setting listeners to all the events we want to track (<strong>Play</strong>/<strong>Pause</strong>/<strong>Seek</strong>) and handle the communication
between the view and the <code>MediaPlayer</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAnchorView</span><span class="o">(</span><span class="kd">final</span> <span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mAnchor</span> <span class="o">=</span> <span class="n">view</span><span class="o">;</span>
</span><span class='line'>    <span class="n">LayoutParams</span> <span class="n">frameParams</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">LayoutParams</span><span class="o">(</span>
</span><span class='line'>            <span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">MATCH_PARENT</span><span class="o">,</span>
</span><span class='line'>            <span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">MATCH_PARENT</span>
</span><span class='line'>    <span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">removeAllViews</span><span class="o">();</span>
</span><span class='line'>    <span class="n">View</span> <span class="n">v</span> <span class="o">=</span> <span class="n">makeControllerView</span><span class="o">();</span>
</span><span class='line'>    <span class="n">addView</span><span class="o">(</span><span class="n">v</span><span class="o">,</span> <span class="n">frameParams</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>TextureVideoView</h2>

<p>At this point we know how the controller is shown / hidden and which component is that view anchored to, but we are missing the big part of this puzzle
which is the View who handles it all, the <code>TextureVideoView</code>.</p>

<p>This view is the only one communicating with the <code>MediaPlayer</code>, which allows us to handle on the interaction between the controller and the player
transparently to the other parts of the application. Going back to the initial state diagram, one can see that it would be very helpful to save
the actual state of the player in order to know which steps can be followed. The <code>TextureVideoView</code> <strong>keeps track internally of that state</strong>.</p>

<p>Another important aspect of the view consists in handling all the listeners that the <code>MediaPlayer</code> exposes</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">mMediaPlayer</span><span class="o">.</span><span class="na">setOnPreparedListener</span><span class="o">(</span><span class="n">mPreparedListener</span><span class="o">);</span>
</span><span class='line'><span class="n">mMediaPlayer</span><span class="o">.</span><span class="na">setOnVideoSizeChangedListener</span><span class="o">(</span><span class="n">mSizeChangedListener</span><span class="o">);</span>
</span><span class='line'><span class="n">mMediaPlayer</span><span class="o">.</span><span class="na">setOnCompletionListener</span><span class="o">(</span><span class="n">mCompletionListener</span><span class="o">);</span>
</span><span class='line'><span class="n">mMediaPlayer</span><span class="o">.</span><span class="na">setOnErrorListener</span><span class="o">(</span><span class="n">mErrorListener</span><span class="o">);</span>
</span><span class='line'><span class="n">mMediaPlayer</span><span class="o">.</span><span class="na">setOnInfoListener</span><span class="o">(</span><span class="n">mInfoListener</span><span class="o">);</span>
</span><span class='line'><span class="n">mMediaPlayer</span><span class="o">.</span><span class="na">setOnBufferingUpdateListener</span><span class="o">(</span><span class="n">mBufferingUpdateListener</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">mMediaPlayer</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="n">mUri</span><span class="o">,</span> <span class="n">mHeaders</span><span class="o">);</span>
</span><span class='line'><span class="n">mMediaPlayer</span><span class="o">.</span><span class="na">setSurface</span><span class="o">(</span><span class="k">new</span> <span class="nf">Surface</span><span class="o">(</span><span class="n">mSurfaceTexture</span><span class="o">));</span>
</span><span class='line'><span class="n">mMediaPlayer</span><span class="o">.</span><span class="na">setAudioStreamType</span><span class="o">(</span><span class="n">AudioManager</span><span class="o">.</span><span class="na">STREAM_MUSIC</span><span class="o">);</span>
</span><span class='line'><span class="n">mMediaPlayer</span><span class="o">.</span><span class="na">setScreenOnWhilePlaying</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'><span class="n">mMediaPlayer</span><span class="o">.</span><span class="na">prepareAsync</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="n">mCurrentState</span> <span class="o">=</span> <span class="n">STATE_PREPARING</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, there is a big chunk of listeners to be set here, not the nicest looking part but the most helpful of all. Not only we&rsquo;ve set
all the listeners but also created the <a href="http://developer.android.com/reference/android/graphics/SurfaceTexture.html">SurfaceTexture</a> <strong>where the video
will be displayed</strong>, set the DataSource with the video information and last but not least important, asked the <code>MediaPlayer</code> to prepare itself in order
to start playing the video.</p>

<p>Important here not to call <code>prepare()</code> but use <code>prepareAsync()</code> instead. As you can imagine the <code>prepare()</code> method is <strong>run in the UI thread</strong> which will block
the application, by using the <code>onPreparedListener</code> we&rsquo;ll be notified when the <code>MediaPlayer</code> can start playing the video. It&rsquo;s just another listener and
we love them, don&rsquo;t we?</p>

<p><strong>Notify when the video is playing</strong></p>

<p>From all those listeners that we&rsquo;ve set earlier, perhaps the one which tells us more about the <code>MediaPlayer</code> status is the <code>onInfoListener()</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">final</span> <span class="n">OnInfoListener</span> <span class="n">onInfoToPlayStateListener</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">OnInfoListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onInfo</span><span class="o">(</span><span class="kd">final</span> <span class="n">MediaPlayer</span> <span class="n">mp</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">what</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">extra</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">noPlayStateListener</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">MediaPlayer</span><span class="o">.</span><span class="na">MEDIA_INFO_VIDEO_RENDERING_START</span> <span class="o">==</span> <span class="n">what</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">onPlayStateListener</span><span class="o">.</span><span class="na">onFirstVideoFrameRendered</span><span class="o">();</span>
</span><span class='line'>          <span class="n">onPlayStateListener</span><span class="o">.</span><span class="na">onPlay</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">MediaPlayer</span><span class="o">.</span><span class="na">MEDIA_INFO_BUFFERING_START</span> <span class="o">==</span> <span class="n">what</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">onPlayStateListener</span><span class="o">.</span><span class="na">onBuffer</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">MediaPlayer</span><span class="o">.</span><span class="na">MEDIA_INFO_BUFFERING_END</span> <span class="o">==</span> <span class="n">what</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">onPlayStateListener</span><span class="o">.</span><span class="na">onPlay</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>These three flags give us vital information, they will tell us <strong>when the first frame of the video starts to play</strong>, when the <strong>MediaPlayer starts buffering</strong> and
when the <strong>video is playing again after buffering</strong>. Finally all this information will be sent to the PlayerController in order to show / hide the controls
and the loading view.</p>

<h2>Introducing Fenster</h2>

<p>To wrap things up, it&rsquo;s always better to have a project to look into it. That&rsquo;s why I&rsquo;ve created <a href="https://github.com/malmstein/fenster">Fenster</a>, a library
where you&rsquo;ll find all these views we&rsquo;ve been talking about in this post and a nice <strong>demo project</strong> to show it all.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/Fenster/master/art/video_example.gif"></p>

<p>As always, <strong>fork it</strong>, <strong>use it</strong>, and if you want to contribute <a href="https://github.com/malmstein/fenster/pulls">pull requests</a> are more than welcome!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[One Month Using a Standing Desk]]></title>
    <link href="http://malmstein.github.io/blog/2014/07/26/one-month-using-a-standing-desk/"/>
    <updated>2014-07-26T18:39:34+01:00</updated>
    <id>http://malmstein.github.io/blog/2014/07/26/one-month-using-a-standing-desk</id>
    <content type="html"><![CDATA[<p>Why not? That&rsquo;s what I said to myself. After reading a lot of <a href="http://www.nytimes.com/2012/12/02/business/stand-up-desks-gaining-favor-in-the-workplace.html?_r=0">interesting</a>
posts and <a href="http://www.smithsonianmag.com/science-nature/five-health-benefits-standing-desks-180950259/">information</a> about standing desks
I decided to give it a go. It can&rsquo;t harm, right? I mean worst case scenario one could just lay on one of the couches around the office and rest.
Now, after one month using a standing desk I can&rsquo;t be clearer about it, I&rsquo;m not sitting anymore.</p>

<!-- more -->


<h2>U sure? That&rsquo;s really tiring, isn&rsquo;t it?</h2>

<p>When I started thinking about it I was very sceptical, wasn&rsquo;t sure about it at all. The sole idea of standing the whole day was not pleasant,
it was all too tiring.</p>

<p>I&rsquo;ve been sitting around since I can recall, that includes all kinds of physical and not physical activities: eating, drinking, studying, reading and
obviously, programming. Yes, we all stand up for our daily standup (yes, you are supposed to stand up in stand up meetings) but after that one
quickly returns to the comfortable chair. That&rsquo;s where we drink our coffee, lay towards a side or if you are lucky enough to have one of those chairs, you
can even lay back and make it look like you are really thinking about something meaningful.</p>

<p>That was my case, the lucky one. It also means that my back was already getting the so-familiar shape of this guy:</p>

<p><img class="center" src="http://3.bp.blogspot.com/-Sec0_UDOhZw/UgtcRkUcSkI/AAAAAAAAAWk/YzWo6WEvvkM/s1600/shutterstock_140199787+%5BConverted%5D.jpg"></p>

<p>I know, you also have it don&rsquo;t you? Well I&rsquo;ve always had it and that&rsquo;s one of the reasons why the standing desk looked like a good idea.</p>

<p>So I decided to give it a go. When making a development proposal at <a href="" title="http://www.novoda.com">Novoda</a> we tend to show three different scopes:</p>

<ol>
<li><strong>MVP or Minimun Viable Product:</strong> That&rsquo;s the minimun set of feature a client can expect to satisfy the business requirements.</li>
<li><strong>MDP or Minimun Desirable Product:</strong> Takes 4 to 6 more sprints to complete, has all the features in the MVP, some exciting new
ones and some really nice UI/UX improvements.</li>
<li><strong>WOW:</strong> This is something worth featuring at Google Play, there is nothing like this in the market and all your competitors will be
jealous of this product.</li>
</ol>


<h2>Minimun viable product or MVP</h2>

<p>So I went on a mission. What&rsquo;s the MVP for a standing desk?</p>

<p>As the name indicates, a standing desk requires the individual to be standing. Ideally your eyes would be at the same height as the screen and
your arms should type the keyboard comfortably enough for 8 hours in that position.</p>

<p>Yes, those are delivery boxes. A nice set of 4 delivery boxes, one for the screen, one for the laptop, another one for the keyboard and the last
one for the mouse. All very ecological and environmental friendly</p>

<p>I worked that way for two weeks, trying to figure out if I actually liked this whole thing of standing. And I have to say, the result was a complete
surprise for me. After one week I could develop ten times faster, my productivity increased 100% and I always arrived on time&hellip; hell no&hellip; I freaking hated
it! My feet were hurting the whole afternoon, the lunch break was indeed a break which my body used to rest and at the end of the day I was tired, really tired.</p>

<p>So, the whole thing was actually working! No one should be tired of standing 9 hours, I&rsquo;m sorry to break your bubble but no, that&rsquo;s not normal nor healthy.</p>

<h2>Minimun desirable product or MDP</h2>

<p>The proof of concept was successful, it worked but it could also be improved enormously. After a few days the boxes under the keyboard and the mouse started
to collapse and the posture was starting to get compromised. It was time to start thinking about new design iterations.</p>

<p>Searching online one can found a <a href="http://lifehacker.com/five-best-standing-desks-1528244287">huge</a> amount of useful information and links about building or
buying a standing desk. Finally, I decided that my next move would be building my own based on <a href="http://iamnotaprogrammer.com/Ikea-Standing-desk-for-22-dollars.html">this</a>.</p>

<p><img class="center" src="https://raw.githubusercontent.com/malmstein/malmstein.github.io/master/images/standing_desk_1.jpg"></p>

<p><img class="center" src="https://raw.githubusercontent.com/malmstein/malmstein.github.io/master/images/standing_desk_2.jpg"></p>

<p><img class="center" src="https://raw.githubusercontent.com/malmstein/malmstein.github.io/master/images/standing_desk_3.jpg"></p>

<p>It&rsquo;s a pretty decent solution, €25 from Ikea in Berlin.</p>

<h2>Some improvements</h2>

<p>After a while the wrists started to feel a bit weird. The position had changed a bit compared to what I used to have in the MVP version and wasn&rsquo;t feeling
very comfortable. So after searching online I found the best possible solutions, a <a href="http://www.amazon.de/gp/product/B004DANDN4/ref=oh_aui_detailpage_o00_s00?ie=UTF8&amp;psc=1">Wrist Pad</a>
and a <a href="http://www.amazon.de/gp/product/B0053XC1J2/ref=oh_aui_detailpage_o00_s01?ie=UTF8&amp;psc=1">Mouse Pad</a>. The Grifiti wrist pad may be almost as
expensive as the whole standing desk but the fact that it&rsquo;s higher than the rest of wrist pads out there made it the perfect choice. I&rsquo;m using a
<a href="https://www.diatec.co.jp/en/det.php?prod_c=1320">Filco mechanical keyboard</a> (if you haven&rsquo;t tried one you should) and the hands position wasn&rsquo;t very
pleasant until the wrist pad was there.</p>

<p>After all, adding the pads to the total cost we are talking about <strong>€50</strong> for the whole thing. Considering that we spend between 9 and 10 hours a day
sitting / standing in our desks I&rsquo;d say it&rsquo;s pretty affordable.</p>

<h2>The conclusion</h2>

<p>So it&rsquo;s been almost over a month and the results are great. It&rsquo;s not easy at the beginning, it&rsquo;s normal to get tired and feel that it&rsquo;s not worth it.
I discovered that my shoes actually were not confortable at all, standing 9 on Converse may be very hipster but definitely not the best you can do
for your feet health.</p>

<p>Once you survive to the first week you&rsquo;ll start noticing how you tend to stand more and sit less, and not just in the office. One morning I suddenly
found myself having breakfast while standing&hellip; that was too much but it&rsquo;s just an example that how natural it all can result in the end.</p>

<p>If you try it please do let me know and if you have any other cool ideas / tips to make a better standing desk do share them too.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Your Forms Don't Need to Be Ugly Part 3]]></title>
    <link href="http://malmstein.github.io/blog/2014/07/09/your-forms-dont-need-to-be-ugly-part-3/"/>
    <updated>2014-07-09T19:03:54+01:00</updated>
    <id>http://malmstein.github.io/blog/2014/07/09/your-forms-dont-need-to-be-ugly-part-3</id>
    <content type="html"><![CDATA[<p>This is the 3 part of a series of posts where we are trying to improve the ui and interaction with forms in Android. <a href="http://www.malmstein.com/blog/2014/06/15/your-forms-dont-need-to-be-ugly-part-2/">Part 2</a>
introduced the <a href="http://www.github.com/malmstein/FloatingHints">FloatingHints</a> library and showed how this simple pattern can make a big impact
in your forms.</p>

<p>The source code for Part 2 is <a href="https://github.com/malmstein/UglyForms/tree/step_two">already available on Github</a>.</p>

<p>On today&rsquo;s post, we will introduce an easy way of dealing with transitions between forms and how to respond to orientation changes</p>

<!-- more -->


<h2>The Form flow does not need to suck</h2>

<p><img class="center" src="https://raw.githubusercontent.com/malmstein/UglyForms/master/art/animate_form.gif"></p>

<p>It&rsquo;s very common to see a welcome message when opening a form which is telling us a bit about the application or simply because someone decided that
we are all still living in the early days of the internet. Don&rsquo;t worry, we got you covered for that.</p>

<p>One of the most annoying things that may happen when navigation through a Login form is when pressing the <strong>Register</strong> button.
I&rsquo;ve seen things, and I&rsquo;m sure you also have! A common example is to jump to a whole new Activity, the user is going to see that ugly change of context,
the famous white background in the screen while the screens change or even worse&hellip; it  may as well send the user to the Browser just
because the application can&rsquo;t handle registrations.</p>

<p>Wouldn&rsquo;t it be nice if you could just have a nicer way of showing all the content?</p>

<h2>Animating transitions</h2>

<p>There are several ways of animating views, <code>ViewPager</code>, <code>ViewAnimator</code>, <code>ViewSwitcher</code> being the most used examples.</p>

<p>Before start using a <code>ViewPager</code> and write adapters, fragments, etc&hellip; let&rsquo;s understand what we are talking about here. This is more a personal
point of view than anything else but, I&rsquo;m just not a big fun of building a castle when I only need a hut. Our form currently has two main goals,
<strong>Sign in</strong> and <strong>Register</strong> users, that&rsquo;s 2 actions and bunch of <code>EditText</code>so let&rsquo;s keep it simple.</p>

<p>We are going to create three different views, one for <strong>Register</strong>, one for the <strong>Welcome message</strong> and the last one for <strong>Signining in</strong>. We will
then use an animator to make the transitions from one view to another. As discussed earlier, <code>ViewPager</code>could be a solution
but I don&rsquo;t see the need of using adapters and fragments for this purpose. <code>ViewSwitcher</code>only allows use to switch between two views so
the ideal candidate for this task is a <code>ViewAnimator</code>.</p>

<p>One thing though, we are not going to show one view after the other. Instead, we are going to switch between views with different animations
by sliding the form left and right depending on the action that the user wants to take. Right, how do we do that?</p>

<h2>The MultipleViewSwitcher</h2>

<p><img class="center" src="https://raw.githubusercontent.com/malmstein/UglyForms/step_three/art/animate_form.gif"></p>

<p>As you can see, after showing the welcome message if the user wants to Register we&rsquo;ll slide the form from the left and if the user wants
to Log in we will slide the form from the right. To do that, the <code>MultipleViewSwitcher</code>needs to add
some new functionality to what the <code>ViewAnimator</code>can do.</p>

<p>The first addition is that we need to be able to change the initial page of the view.
There are several ways of doing this but since we are extending <code>ViewAnimator</code>and I really like to use the <code>ViewAttributes</code>we will
set this initial page as an attribute.</p>

<p><strong>attrs.xml</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>  <span class="nt">&lt;declare-styleable</span> <span class="na">name=</span><span class="s">&quot;MultipleViewSwitcher&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">&quot;initialPage&quot;</span> <span class="na">format=</span><span class="s">&quot;integer&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/declare-styleable&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our new view is now able to use this attribute and change the displayed page once it&rsquo;s inflated. Note that this page change can&rsquo;t be done
before the view is inflated since it has not computed yet all all it&rsquo;s children nor added them to the <code>ViewGroup</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MultipleViewSwitcher</span> <span class="kd">extends</span> <span class="n">ViewAnimator</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">private</span> <span class="kt">int</span> <span class="n">initialChild</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">public</span> <span class="nf">MultipleViewSwitcher</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">this</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">public</span> <span class="nf">MultipleViewSwitcher</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">this</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">public</span> <span class="nf">MultipleViewSwitcher</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyle</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">TypedArray</span> <span class="n">a</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">obtainStyledAttributes</span><span class="o">(</span><span class="n">attrs</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">MultipleViewSwitcher</span><span class="o">,</span> <span class="n">defStyle</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'>          <span class="n">initialChild</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">MultipleViewSwitcher_initialPage</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">a</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onFinishInflate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="kd">super</span><span class="o">.</span><span class="na">onFinishInflate</span><span class="o">();</span>
</span><span class='line'>          <span class="n">displayInitialViewIfNecessary</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">private</span> <span class="kt">void</span> <span class="nf">displayInitialViewIfNecessary</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="o">(</span><span class="n">initialChild</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
</span><span class='line'>              <span class="n">setDisplayedChild</span><span class="o">(</span><span class="n">initialChild</span><span class="o">);</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you all know, the first view in the <code>ViewAnimator</code>has the id 0 so we are going to set our initialPage as 1:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>    <span class="nt">&lt;com.malmstein.widgets.MultipleViewSwitcher</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/form_animator&quot;</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">app:initialPage=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;include</span>
</span><span class='line'>        <span class="na">android:id=</span><span class="s">&quot;@+id/form_register&quot;</span>
</span><span class='line'>        <span class="na">layout=</span><span class="s">&quot;@layout/view_form_register&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;include</span>
</span><span class='line'>        <span class="na">android:id=</span><span class="s">&quot;@+id/form_welcome_message&quot;</span>
</span><span class='line'>        <span class="na">layout=</span><span class="s">&quot;@layout/view_form_welcome&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;include</span>
</span><span class='line'>        <span class="na">android:id=</span><span class="s">&quot;@+id/form_login&quot;</span>
</span><span class='line'>        <span class="na">layout=</span><span class="s">&quot;@layout/view_form_login&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;/com.malmstein.widgets.MultipleViewSwitcher&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Cool, now all the form is in place and our first page is the <strong>Welcome Message</strong>. Earlier we said that we wanted to animate the
transitions between forms, and that&rsquo;s exactly what the <code>MultipleViewSwitcher</code>is made for. Basically, there are two methods and attributes
that we are going to use in order to achieve this <code>setInAnimation(Animation inAnimation)</code>and <code>setOutAnimation(Animation inAnimation)</code></p>

<p>As you&rsquo;ve seen, the forms are not always sliding into the same direction but changing based on the current page. In order to achieve that we are also
going to add some changes to the transition logic so this can be easily handled.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Animates the view to the next children using the animations specified</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * @param inAnimation The inAnimation</span>
</span><span class='line'><span class="cm">     * @param outAnimation The outAnimation</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">animateNext</span><span class="o">(</span><span class="n">Animation</span> <span class="n">inAnimation</span><span class="o">,</span> <span class="n">Animation</span> <span class="n">outAnimation</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">setInAnimation</span><span class="o">(</span><span class="n">inAnimation</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setOutAnimation</span><span class="o">(</span><span class="n">outAnimation</span><span class="o">);</span>
</span><span class='line'>        <span class="n">showNext</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Animates the view to the next children using the animations specified</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * @param context              The application&#39;s environment.</span>
</span><span class='line'><span class="cm">     * @param inAnimationResource  The resource id of the inAnimation.</span>
</span><span class='line'><span class="cm">     * @param outAnimationResource The resource id of the outAnimation.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">animateNext</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">int</span> <span class="n">inAnimationResource</span><span class="o">,</span> <span class="kt">int</span> <span class="n">outAnimationResource</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">animateNext</span><span class="o">(</span><span class="n">AnimationUtils</span><span class="o">.</span><span class="na">loadAnimation</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">inAnimationResource</span><span class="o">),</span>
</span><span class='line'>                <span class="n">AnimationUtils</span><span class="o">.</span><span class="na">loadAnimation</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">outAnimationResource</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The view allows us to set two Animations which we will use to animate the views accordingly. Looking into
the <a href="http://developer.android.com/reference/android/widget/ViewAnimator.html">ViewAnimator</a> implementation one can
see that it&rsquo;s holding refference to both the <strong>In</strong> and the <strong>Out</strong> Animations, so there is no need for our new View to add more overhead to it.
It is our responsability though to keep an eye on how many Animations we are loading and how we do it. Same as the <code>ViewAnimator</code>, the <code>MultipleViewSwitcher</code>
can receive a new Animation by parameter or the resourceId of it which we will then load with <code>AnimationUtils.loadAnimation(context, animationResource)</code></p>

<p>At this point we hace achieved all the goals of the wanted but there is a small annoying issue, when rotating the device we are not saving the
current displayed child <code>ViewAnimator</code>does not do it either, so it would be the Activity/Fragment responsibility. I&rsquo;d much rather have this solved
in the View so we are going to save the state of the View when rotation.</p>

<h2>Saving the state of the view</h2>

<p>Since our form is now composed by more than one view, it would be nice to save the displayed child on orientation changes. No one wants to move the device from portrait to landscape
and realise that the form is now showing the initial page. This view is not just usable in forms, one can easily use it to handle the on boarding wizard of an application.
Can you imagine how frustrated the user would be if after swiping through four screens, the device is rotated and the wizards needs to be completed from the beginning?</p>

<p>Android uses <code>Parcelable</code>to save the <a href="http://developer.android.com/reference/android/view/View.html#onSaveInstanceState(">instance state</a>). I&rsquo;ve seen plenty of implementations
creating their own Parcelable, etc&hellip; but the easiest way in my opinion is using a <a href="http://developer.android.com/reference/android/os/Bundle.html">Bundle</a> (which implements Parcelable)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Parcelable</span> <span class="nf">onSaveInstanceState</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Bundle</span><span class="o">();</span>
</span><span class='line'>        <span class="n">bundle</span><span class="o">.</span><span class="na">putParcelable</span><span class="o">(</span><span class="s">&quot;instanceState&quot;</span><span class="o">,</span> <span class="kd">super</span><span class="o">.</span><span class="na">onSaveInstanceState</span><span class="o">());</span>
</span><span class='line'>        <span class="n">bundle</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="s">&quot;displayedChild&quot;</span><span class="o">,</span> <span class="n">getDisplayedChild</span><span class="o">());</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">bundle</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRestoreInstanceState</span><span class="o">(</span><span class="n">Parcelable</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">state</span> <span class="k">instanceof</span> <span class="n">Bundle</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="o">(</span><span class="n">Bundle</span><span class="o">)</span> <span class="n">state</span><span class="o">;</span>
</span><span class='line'>            <span class="n">initialChild</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">&quot;displayedChild&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">setDisplayedChild</span><span class="o">(</span><span class="n">initialChild</span><span class="o">);</span>
</span><span class='line'>            <span class="n">state</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="na">getParcelable</span><span class="o">(</span><span class="s">&quot;instanceState&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onRestoreInstanceState</span><span class="o">(</span><span class="n">state</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When the device&rsquo;s orientation changes, the view itself will save it&rsquo;s instance state and restore the displayed child. It&rsquo;s very important that the View has it&rsquo;s own id defined
in the XML layout, if it doesn&rsquo;t the <code>onSaveInstanceState()</code>and <code>onRestoreInstanceState()</code>won&rsquo;t be called and state won&rsquo;t be restored.</p>

<h2>Show me the code</h2>

<p>If this caught your attention, please check the source code for Part 3 <a href="https://github.com/malmstein/UglyForms/tree/step_three">already available on Github</a>.</p>

<p>The next part will be last one and will add some love to the overall look and feel in addition to some interesting ideas about buttons and input keyboard handling.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Your Forms Don't Need to Be Ugly Part 2]]></title>
    <link href="http://malmstein.github.io/blog/2014/06/15/your-forms-dont-need-to-be-ugly-part-2/"/>
    <updated>2014-06-15T13:26:51+01:00</updated>
    <id>http://malmstein.github.io/blog/2014/06/15/your-forms-dont-need-to-be-ugly-part-2</id>
    <content type="html"><![CDATA[<p>Last week we <a href="http://www.malmstein.com/blog/2014/06/09/your-forms-dont-need-to-be-ugly-part-1/">started to talk</a> about how ugly forms can be displayed and raised some issues about it. Today is time to stop ranting and
start contributing.</p>

<h2>Introducing FloatingHints</h2>

<p>A while ago thanks to <a href="https://plus.google.com/+ChrisBanes/posts/5Ejaq51UWGo">Chris Banes</a> and <a href="https://plus.google.com/118417777153109946393/posts/ewdTd7bNw29">Cyril Mottier</a> there was a buzz around a pattern called Floating Label Layout. I used this approach in
the last project I&rsquo;ve been working on and the feedback was very good. Therefore, I&rsquo;m releasing this small library called <a href="https://github.com/malmstein/FloatingHints">FloatingHints</a> which
you could use if you want to add a bit of styling to those ugly forms.</p>

<p>The snapshot version is <strong>already available</strong> at Sonatype while the release version will be soon released at Maven Central.</p>

<!-- more -->


<h2>If you wouldn&rsquo;t use that form, why would the user?</h2>

<p>In the previous post from the series we saw one of the most common form structures. A couple of EditText where the user will write the
user and password and a button used to start the Login action.</p>

<p>With the addition of the Floating Label pattern one can have a much nicer and clear screen. No one likes to fill these forms, not even the users
excited about using your service&hellip; so why don&rsquo;t we encourage them to do so?</p>

<p><img src="https://lh4.googleusercontent.com/-65P7JghkHg0/U5X0kJ1SzEI/AAAAAAAAEvI/UijRmzcr1r4/w1118-h570-no/device-2014-06-05-155250.jpg"></p>

<h2>Custom Animations</h2>

<p>One of the key features of FloatingHints is that the animations which are in charge of showing or hiding the floating hint are fully customisable.
By default, the hint will be shown using a <strong>Slide in to Top</strong> and will be hidden using a <strong>Slide out to Bottom</strong></p>

<p><img class="center" src="https://raw.githubusercontent.com/malmstein/FloatingHints/master/art/floating.gif"></p>

<p>This can be easily customised via XML attributes.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>  <span class="nt">&lt;com.malmstein.floatinghints.FloatingHintEditTextLayout</span>
</span><span class='line'>    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>    <span class="na">app:floatLayoutInAnimation=</span><span class="s">&quot;@anim/abc_fade_in&quot;</span>
</span><span class='line'>    <span class="na">app:floatLayoutOutAnimation=</span><span class="s">&quot;@anim/abc_fade_out&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;EditText</span>
</span><span class='line'>      <span class="na">style=</span><span class="s">&quot;@style/FloatLabel.Form.Text&quot;</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/float_login_email&quot;</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:hint=</span><span class="s">&quot;@string/hint_email&quot;</span>
</span><span class='line'>      <span class="na">android:inputType=</span><span class="s">&quot;textEmailAddress&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;/com.malmstein.floatinghints.FloatingHintEditTextLayout&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The result of using <strong>Fade In</strong> and <strong>Fade Out</strong> is pretty good too!</p>

<p><img class="center" src="https://raw.githubusercontent.com/malmstein/FloatingHints/master/art/floating_fade.gif"></p>

<h2>Customise the color of the hint</h2>

<p>The <code>FloatingHintEditTextLayout</code> uses the attribute <code>floatLayoutTextAppearance</code> to change the <a href="http://developer.android.com/reference/android/widget/TextView.html#attr_android:textAppearance">TextAppearance</a>
of the Label.</p>

<p><strong>activity_demo.xml</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>  <span class="nt">&lt;com.malmstein.floatinghints.FloatingHintEditTextLayout</span>
</span><span class='line'>    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>    <span class="na">app:floatLayoutInAnimation=</span><span class="s">&quot;@anim/abc_fade_in&quot;</span>
</span><span class='line'>    <span class="na">app:floatLayoutOutAnimation=</span><span class="s">&quot;@anim/abc_fade_out&quot;</span>
</span><span class='line'>    <span class="na">app:floatLayoutTextAppearance=</span><span class="s">&quot;@style/FloatLabel.Label&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;EditText</span>
</span><span class='line'>      <span class="na">style=</span><span class="s">&quot;@style/FloatLabel.Form.Text&quot;</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/float_login_email&quot;</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:hint=</span><span class="s">&quot;@string/hint_email&quot;</span>
</span><span class='line'>      <span class="na">android:inputType=</span><span class="s">&quot;textEmailAddress&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;/com.malmstein.floatinghints.FloatingHintEditTextLayout&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>styles.xml</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>  <span class="nt">&lt;style</span> <span class="na">name=</span><span class="s">&quot;FloatLabel.Label&quot;</span> <span class="na">parent=</span><span class="s">&quot;android:TextAppearance.Small&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:textColor&quot;</span><span class="nt">&gt;</span>@color/float_edit_text_layout_color<span class="nt">&lt;/item&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:textSize&quot;</span><span class="nt">&gt;</span>@dimen/text_xs<span class="nt">&lt;/item&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:textStyle&quot;</span><span class="nt">&gt;</span>bold<span class="nt">&lt;/item&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/style&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>float_edit_text_layout_color.xml</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;selector</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;item</span> <span class="na">android:color=</span><span class="s">&quot;@color/font_yellow&quot;</span> <span class="na">android:state_activated=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;item</span> <span class="na">android:color=</span><span class="s">&quot;@color/font_grey&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/selector&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This way we&rsquo;ve just changed the text appearance of the label to yellow.</p>

<p><img class="center" src="https://raw.githubusercontent.com/malmstein/FloatingHints/master/art/floating_fade_yellow.gif"></p>

<h2>Wrapping up</h2>

<p>The <a href="https://github.com/malmstein/FloatingHints/tree/master/app/src/main">demo</a> project from <a href="https://github.com/malmstein/FloatingHints">FloatingHints</a> contains a wrap up of all the ideas in this post.
Check it out, fork it and don&rsquo;t hesitate in giving some feedback. It will be very much appreciated.</p>

<p>Stay tuned for the next post of the series!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Your Forms Don't Need to Be Ugly Part 1]]></title>
    <link href="http://malmstein.github.io/blog/2014/06/09/your-forms-dont-need-to-be-ugly-part-1/"/>
    <updated>2014-06-09T20:39:09+01:00</updated>
    <id>http://malmstein.github.io/blog/2014/06/09/your-forms-dont-need-to-be-ugly-part-1</id>
    <content type="html"><![CDATA[<p>We all have crated login or signup forms, and quite frankly, most of them are boring, ugly and non responsive to orientation changes.</p>

<!-- more -->


<h2>Why?</h2>

<p>Forms are one of those screens in your application where a lot of business rules need to be accomplished. Those rules force us to have
mandatory fields that are not the most appealing ones from a UI point of view. Maybe the country of origin is mandatory field, the group
of age or even the gender.</p>

<p>Without taking into consideration the fact that many apps nowadays force uses to login before actually using it, it may well have a reason for it, those
forms should not frustrate the user nor lead them to exit the app&hellip; it should engage them!</p>

<p>For that reason, the login screen should be polished.</p>

<p>Links to</p>

<h2>How to improve them</h2>

<p>This is the start of a series of posts on how to improve the look and feel of your forms, suggestions or ideas that could make an impact
in your application and the way how users feel when they see them. There are several mistakes that can be easily fixed and that require just
a bit of polishing taste.</p>

<p>All buttons must have <a href="http://developer.android.com/guide/topics/resources/drawable-resource.html#StateList">state list</a> and should respect the same padding.</p>

<p><img src="https://lh4.googleusercontent.com/-65P7JghkHg0/U5X0kJ1SzEI/AAAAAAAAEvI/UijRmzcr1r4/w1118-h570-no/device-2014-06-05-155250.jpg"></p>

<p>Padding between elements is very important, the example above shows a Sign In with Gmail button with wrong padding from <a href="http://www.hoteltonight.com">HotelTonight</a>.</p>

<p>Actions should never take the user to another context. If there is a registration link leading to an external browser you should first think why does that
need to be leading to an external browser in the first place. In case the transition is necessary, there are <a href="http://cyrilmottier.com/2014/05/20/custom-animations-with-fragments/">several</a>
<a href="http://developer.android.com/training/animation/cardflip.html">examples</a> on how to create transitions between elements that are appealing to the eye.</p>

<p>In the next part of this series we&rsquo;ll start adding some love to a boring login screen.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Blogging Again]]></title>
    <link href="http://malmstein.github.io/blog/2014/06/07/blogging-again/"/>
    <updated>2014-06-07T20:07:34+01:00</updated>
    <id>http://malmstein.github.io/blog/2014/06/07/blogging-again</id>
    <content type="html"><![CDATA[<p>After a couple of years being lazy and just reading what others wrote, I belive it&rsquo;s time to start blogging again. One could explain inspring stories about
blogging and black holes but I&rsquo;m just going to explain why I chose Octopress over other blogging platforms and how I made it work for me.</p>

<!-- more -->


<h2>Why?</h2>

<p>There are several blogging platforms out there, they all have their features and some of them are easier to use. The likes of <a href="https://wordpress.com/">Wordpress</a>, <a href="https://ghost.org/">Ghost</a>, <a href="https://medium.com/">Medium</a>, etc&hellip;
are more than good options in order to start. In my case, I used Wordpress in the past, still use it for some other projects but I wanted to use something new for me.</p>

<p>Markdown files are a great way of writing text, it won&rsquo;t be the best option if you are trying to write a novel but if you are familiar with Github you&rsquo;d probably
have used them in the past. Octopress text editing is based on Markdown files, that was a plus. Octopress also supports Github Pages and the whole publishing process
is based on Git, what else could you ask?</p>

<h2>Installing Octopress</h2>

<ol>
<li>Install <a href="http://git-scm.com/">Git</a></li>
<li>Install Ruby (1.9.3p194 using <a href="http://octopress.org/docs/setup/rbenv/">rbenv</a> when writing this post)</li>
<li>Clone <a href="http://octopress.org/">Octopress</a></li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git clone git://github.com/imathis/octopress.git octopress
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>octopress
</span></code></pre></td></tr></table></div></figure>


<p>Next, install dependencies.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>gem install bundler
</span><span class='line'><span class="nv">$ </span>rbenv rehash
</span><span class='line'><span class="nv">$ </span>bundle install
</span></code></pre></td></tr></table></div></figure>


<p>Install the default Octopress theme.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rake install
</span></code></pre></td></tr></table></div></figure>


<p>At this point you have Octopress installed and the default theme installed, now we need to deploy it. Octopress supports deployment on GitHub pages
and that&rsquo;s the method I chose.</p>

<h2>Deploying to Github Pages</h2>

<p>Github allows you to host a blog from <code>http://username.github.io</code>, where <code>username</code> is your Github username.</p>

<p>Github Pages for users and organisations uses the master branch like the public directory on a web server, serving up the files at your Pages url <a href="http://username.github.io.">http://username.github.io.</a>
As a result, you&rsquo;ll want to work on the source for your blog in the source branch and commit the generated content to the master branch. Octopress has a configuration task that helps you set all this up.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rake setup_github_pages
</span></code></pre></td></tr></table></div></figure>


<p>The rake task will ask you for a URL of the Github repo. Copy the SSH or HTTPS URL from your newly created repository (e.g. git@github.com:username/username.github.io.git) and paste it in as a response.</p>

<p>Done, at this point your Github page is ready to be deployed, but first we need to generate the blog.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rake generate
</span><span class='line'><span class="nv">$ </span>rake deploy
</span></code></pre></td></tr></table></div></figure>


<p>This will generate your blog, copy the generated files into _deploy/, add them to git, commit and push them up to the master branch. In a few seconds you should get an email from Github telling you that your commit has been received and will be published on your site.</p>

<p>As you would do with any other git based project, after adding some code you&rsquo;d add it and commit it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git add .
</span><span class='line'><span class="nv">$ </span>git commit -m <span class="s1">&#39;your commit message&#39;</span>
</span><span class='line'><span class="nv">$ </span>git push origin <span class="nb">source</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Using a custom domain</h2>

<p>First thing that needs to be added is a <code>CNAME</code> in the blog&rsquo;s source.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;www.malmstein.com&#39;</span> &gt;&gt; <span class="nb">source</span>/CNAME
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;m using a main domain, so all I had to do is modifying the DNS host and add a new <code>CNAME</code> record for <code>www</code> pointing to <code>malmstein.github.io</code></p>

<p>Done!</p>

<p>Further reading and more detailed instruction can be found in the <a href="http://octopress.org/docs/configuring/">Octopress</a> documentation.
There is also a very useful <a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">cheat sheet</a> for markdown files.</p>
]]></content>
  </entry>
  
</feed>
