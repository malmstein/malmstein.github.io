
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Yahnac Meets the Design Support Library - David Gonzalez</title>
  <meta name="author" content="David Gonzalez">

  
  <meta name="description" content="It&rsquo;s been a while since Yahnac has received some love. There were several
features I wanted to add and also some very
good ideas worth &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://malmstein.github.io/blog/2015/09/20/yahnac-meets-the-material-design-library">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="David Gonzalez" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-50897004-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">David Gonzalez</a></h1>
  
    <h2>Android Software Craftsman</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:malmstein.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/about">About me</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Yahnac Meets the Design Support Library</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-20T09:37:48+01:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:37 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>It&rsquo;s been a while since Yahnac <a href="http://www.malmstein.com/blog/2015/04/05/yahnacs-rx-pipeline/">has received some love</a>. There were several
features I wanted to add and also <a href="https://github.com/malmstein/yahnac/issues/25">some</a> very
<a href="https://github.com/malmstein/yahnac/issues/27">good</a> ideas worth exploring.</p>

<p>A fully featured Hacker News client needs to allow the user to <strong>sign in</strong>, <strong>vote</strong> stories and <strong>reply</strong> to comments. Finally, all those features are now available in <a href="https://play.google.com/store/apps/details?id=com.malmstein.yahnac">Yahnac</a>. If you are curious to read about the journey to complete those features and the use of the <a href="http://android-developers.blogspot.co.uk/2015/05/android-design-support-library.html">Design Support Library</a> to do so please read on.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/top_stories.png"></p>

<!-- more -->


<p>There are, literally, hundreds of posts about how to use the <strong>Design Support Library</strong>. This is not going to be one of those, my goal here is to explain what I&rsquo;ve used and why. As you know, there are a huge number of <a href="http://developer.android.com/reference/android/support/design/widget/package-summary.html">Widgets</a>, <a href="http://developer.android.com/reference/android/support/design/widget/CoordinatorLayout.Behavior.html">Behaviours</a> and other goodies available in this library. It also means that there are a lot of decisions that need to be made before starting implementing them.</p>

<h1>The glue</h1>

<p>It&rsquo;s very easy to get lost in the vast ocean of possibilities, and to me that&rsquo;s the most difficult step to integrate with the Design Support Library. So many options, that is very easy to start adding animations, transitions and effects that are just pretty but are just there for a <strong>mere aesthetic reason and not to bring value to the user</strong>.</p>

<p>When deciding which was going to be the first component I wanted to update it was very simple, the old <code>NavigationDrawer</code> was a clear winner.</p>

<h2>NavigationView</h2>

<p>There was using was a lot of boilerplate used and several classes in order to display a simple <code>Drawer</code>, thanks to the new <a href="https://developer.android.com/reference/android/support/design/widget/NavigationView.html">NavigationView</a> it&rsquo;s all much easier and cleaner</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;android.support.design.widget.NavigationView</span>
</span><span class='line'>  <span class="na">android:id=</span><span class="s">&quot;@+id/nav_view&quot;</span>
</span><span class='line'>  <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>  <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>  <span class="na">android:layout_gravity=</span><span class="s">&quot;start&quot;</span>
</span><span class='line'>  <span class="na">android:fitsSystemWindows=</span><span class="s">&quot;true&quot;</span>
</span><span class='line'>  <span class="na">app:headerLayout=</span><span class="s">&quot;@layout/view_drawer_header&quot;</span>
</span><span class='line'>  <span class="na">app:menu=</span><span class="s">&quot;@menu/drawer_view&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Thanks to the <code>headerLayout</code> attribute one can define a specific view to be inflated as a header.
Since we are going to show a different header if the user is signed in or not, we can make use of the custom view to decide which layout to inflate.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onFinishInflate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onFinishInflate</span><span class="o">();</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">loginSharedPreferences</span><span class="o">.</span><span class="na">isLoggedIn</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">LayoutInflater</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">getContext</span><span class="o">()).</span><span class="na">inflate</span><span class="o">(</span>
</span><span class='line'>        <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">view_drawer_header_logged_in</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">LayoutInflater</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">getContext</span><span class="o">()).</span><span class="na">inflate</span><span class="o">(</span>
</span><span class='line'>        <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">view_drawer_header_logged_out</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/drawer_signed_in.png"></p>

<h2>TextInputLayout</h2>

<p>In order to reply to comments and vote stories, one need to be signed into <a href="https://news.ycombinator.com/">Hacker News</a>. Even though there is an API, it&rsquo;s not possible to authenticate against HN. Therefore, the only way to do that is to go through the actual website.</p>

<p><strong>Yahnac does not store any private or sensible information from the user</strong>, the only data stored is the cookie that allows to authenticate the requests. That being said, there is a known issue with this workaround. Every time the cookie is expired (if you sign out from the HN website) you&rsquo;ll need to sign in again. Don&rsquo;t worry, you&rsquo;ll be notified if that happens and you&rsquo;ll be able to sign in again.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/login_screen.png"></p>

<h2>Toolbar and TabLayout</h2>

<p>It was pretty simple to migrate from the old <a href="https://developer.android.com/reference/android/app/ActionBar.html">ActionBar</a> to the new <a href="https://developer.android.com/reference/android/widget/Toolbar.html">Toolbar</a>. One of those things that make us developers happy. In terms of the new features available, following the trend started a while back by several applications we&rsquo;ll be hiding the toolbar when scrolling the list.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;android.support.design.widget.CoordinatorLayout</span>
</span><span class='line'>  <span class="na">android:id=</span><span class="s">&quot;@+id/main_content&quot;</span>
</span><span class='line'>  <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>  <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;android.support.design.widget.AppBarLayout</span>
</span><span class='line'>    <span class="na">android:id=</span><span class="s">&quot;@+id/appbar&quot;</span>
</span><span class='line'>    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>    <span class="na">android:theme=</span><span class="s">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;android.support.v7.widget.Toolbar</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/toolbar&quot;</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;?attr/actionBarSize&quot;</span>
</span><span class='line'>      <span class="na">android:background=</span><span class="s">&quot;?attr/colorPrimary&quot;</span>
</span><span class='line'>      <span class="na">app:popupTheme=</span><span class="s">&quot;@style/ThemeOverlay.AppCompat.Light&quot;</span>
</span><span class='line'>      <span class="na">app:layout_scrollFlags=</span><span class="s">&quot;scroll|enterAlways&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;android.support.design.widget.TabLayout</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/tabs&quot;</span>
</span><span class='line'>      <span class="na">android:paddingLeft=</span><span class="s">&quot;@dimen/appbar_swipe_tabs_left_padding&quot;</span>
</span><span class='line'>      <span class="na">app:tabMode=</span><span class="s">&quot;scrollable&quot;</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;/android.support.design.widget.AppBarLayout&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;android.support.v4.view.ViewPager</span>
</span><span class='line'>    <span class="na">android:id=</span><span class="s">&quot;@+id/viewpager&quot;</span>
</span><span class='line'>    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">app:layout_behavior=</span><span class="s">&quot;@string/appbar_scrolling_view_behavior&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/android.support.design.widget.CoordinatorLayout&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>One can see the reference to <a href="https://developer.android.com/reference/android/support/design/widget/AppBarLayout.ScrollingViewBehavior.html">Scroll View Behaviour</a> which is by the <code>ViewPager</code> which can scroll vertically and support nested scrolling to automatically scroll any <code>AppBarLayout</code> siblings.</p>

<p>The new attribute <code>scroll:flags</code> is used to determine how the <code>Toolbar</code> will behave. In our case, we want the <code>Toolbar</code> to hide when scrolling up but appear again as soon as we scroll down.</p>

<h1>Coordinator Layout</h1>

<p>A lot has been written about the <a href="https://developer.android.com/reference/android/support/design/widget/CoordinatorLayout.html">CoordinatorLayout</a>, its possibilities and ways of achieving them are out of the scope of this post. However, there is a screen in Yahnac where it made sense to make use of that so called super-powered <code>FrameLayout</code>.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/coordinator_comments.gif"></p>

<p>The Comments screen deserved some love, I wasn&rsquo;t very happy with the actual layour of the comments and it surely could be improved. Also, <strong>adding the vote and reply action to each one of the comments needed a bit more thinking</strong>. In the end, the best solution I came up with was to add action icons to the old comment list items and change the background to improve the reading experience.</p>

<p>After these changes, it&rsquo;s much easier to follow the conversation and much easier to read through a long list of comments.</p>

<h1>Transitions and Animations</h1>

<p>As said earlier, it&rsquo;s very easy to fall into the trap of adding too much animations and transitions. It&rsquo;s been hard to restrain myself but I think the outcome is what I wanted to achieve.</p>

<p>In an application like this with no images, there not much space for transitions between master and detail screens. However, one can also <strong>use color as a foundation for these transitions</strong>. That being said, there are only two places where it makes sense to animate the transition between screens. One of them being the transition to the login screen.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/transition_login.gif"></p>

<p>Both are pretty straight forward Activity transitions, where the content from one screen is animated to the next screen by changing its bounds.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;transitionSet</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;changeBounds</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;changeTransform</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;changeClipBounds</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;changeImageTransform</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;arcMotion</span> <span class="na">android:minimumHorizontalAngle=</span><span class="s">&quot;45&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/transitionSet&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The animation itself is set in the <code>Activity</code> theme.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;style</span> <span class="na">name=</span><span class="s">&quot;Theme.HNews.News&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:windowSharedElementEnterTransition&quot;</span><span class="nt">&gt;</span>@transition/login_enter<span class="nt">&lt;/item&gt;</span>
</span><span class='line'><span class="nt">&lt;/style&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Last but not least, we need to set the <code>Views</code> that will form the transition.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoginClicked</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'><span class="kd">final</span> <span class="n">android</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Pair</span><span class="o">[]</span> <span class="n">pairs</span> <span class="o">=</span>
</span><span class='line'>  <span class="n">TransitionHelper</span><span class="o">.</span><span class="na">createSafeTransitionParticipants</span><span class="o">(</span>
</span><span class='line'>    <span class="n">activity</span><span class="o">,</span>
</span><span class='line'>    <span class="kc">false</span><span class="o">,</span>
</span><span class='line'>    <span class="k">new</span> <span class="n">android</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Pair</span><span class="o">&lt;&gt;(</span><span class="n">drawer</span><span class="o">,</span> <span class="n">VIEW_TOOLBAR_TITLE</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">ActivityOptions</span> <span class="n">sceneTransitionAnimation</span> <span class="o">=</span>
</span><span class='line'><span class="n">ActivityOptions</span><span class="o">.</span><span class="na">makeSceneTransitionAnimation</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="n">pairs</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">final</span> <span class="n">Bundle</span> <span class="n">transitionBundle</span> <span class="o">=</span> <span class="n">sceneTransitionAnimation</span><span class="o">.</span><span class="na">toBundle</span><span class="o">();</span>
</span><span class='line'><span class="n">Intent</span> <span class="n">commentIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="n">LoginActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">ActivityCompat</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span>
</span><span class='line'>  <span class="n">activity</span><span class="o">,</span>
</span><span class='line'>  <span class="n">commentIntent</span><span class="o">,</span>
</span><span class='line'>  <span class="n">transitionBundle</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The majority of logic is set in the origin <code>Activity</code>, now the only missing piece is to set the <code>TransitionName</code> in the target <code>LoginActivity</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'>    <span class="n">ViewCompat</span><span class="o">.</span><span class="na">setTransitionName</span><span class="o">(</span><span class="n">appBar</span><span class="o">,</span> <span class="n">VIEW_TOOLBAR_TITLE</span><span class="o">);</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In terms of animations, I&rsquo;ve been particularly interested in the <a href="https://developer.android.com/reference/android/view/ViewAnimationUtils.html#createCircularReveal(android.view.View,%20int,%20int,%20float,%20float">circular reveal</a>). When prompting the user for some input it&rsquo;s normal to use <code>Dialogs</code> but they are always limiting the amount of space available. In <a href="https://news.ycombinator.com/">Hacker News</a> is usual to find comments that take more than just 4 lines, if only there was a way of replying to a comment AND have enough space to review it&hellip;</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/reveal_reply.gif"></p>

<p>As you also know, this animation is only available for Lollipop and above. Even though there are several libraries that create this animation before Lollipop, I&rsquo;m of the opinion that the OS requirements are there for a reason. <strong>Don&rsquo;t back-port them to previous versions since you&rsquo;ll be modifying the default platform behaviour</strong>. Same goes for <code>Ripples</code>&hellip;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">showReplyView</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">centerX</span> <span class="o">=</span> <span class="o">(</span><span class="n">replyFab</span><span class="o">.</span><span class="na">getLeft</span><span class="o">()</span> <span class="o">+</span> <span class="n">replyFab</span><span class="o">.</span><span class="na">getRight</span><span class="o">())</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">centerY</span> <span class="o">=</span> <span class="o">(</span><span class="n">replyFab</span><span class="o">.</span><span class="na">getTop</span><span class="o">()</span> <span class="o">+</span> <span class="n">replyFab</span><span class="o">.</span><span class="na">getBottom</span><span class="o">())</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">finalRadius</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">replyView</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">replyView</span><span class="o">.</span><span class="na">getHeight</span><span class="o">());</span>
</span><span class='line'>    <span class="n">mCircularReveal</span> <span class="o">=</span> <span class="n">ViewAnimationUtils</span><span class="o">.</span><span class="na">createCircularReveal</span><span class="o">(</span>
</span><span class='line'>            <span class="n">replyView</span><span class="o">,</span> <span class="n">centerX</span><span class="o">,</span> <span class="n">centerY</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">finalRadius</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mCircularReveal</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span><span class="k">new</span> <span class="nf">AnimatorListenerAdapter</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAnimationEnd</span><span class="o">(</span><span class="n">Animator</span> <span class="n">animation</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="kd">super</span><span class="o">.</span><span class="na">onAnimationEnd</span><span class="o">(</span><span class="n">animation</span><span class="o">);</span>
</span><span class='line'>            <span class="n">mCircularReveal</span><span class="o">.</span><span class="na">removeListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mCircularReveal</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>    <span class="n">replyFab</span><span class="o">.</span><span class="na">hide</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">replyView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
</span><span class='line'>    <span class="n">commentsView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Behaviours</h1>

<p>One of the most interesting new feature that <code>CoordinatorLayout</code> brings is the use of <code>Behaviours</code>. One can set dependencies between <code>Views</code> and react to the changes in the dependent view.</p>

<p>The Design Library already has several examples of <code>Behaviours</code> and those are a very good starting point for us. In this case, the idea was to hide the <code>FloatingActionBar</code> when scrolling up the comments list so the reading experience wasn&rsquo;t compromised.</p>

<p>In order to do so, we want the <code>FAB</code> to scroll anchored to the <code>AppBarLayout</code> and disappear once the its dependent view is no longer visible.</p>

<p><img src="https://raw.githubusercontent.com/malmstein/yahnac/master/art/fab_behaviour.gif"></p>

<p>For this purpose we are going to extend the <a href="https://developer.android.com/reference/android/support/design/widget/FloatingActionButton.Behavior.html">FloatingActionButton.Behavior</a>. Basically, we only react to vertical scroll and default to the <code>CoordinatorLayout</code> scroll. Called when a descendant of the <code>CoordinatorLayout</code> attempts to initiate a nested scroll.</p>

<p>Once the <code>AppBarLayout</code> is hidden then the <code>FloatingActionBar</code> needs to be hidden as well. In order to do so we just have to check the vertical offset and start the out animation. To make things a bit more interesting we&rsquo;ll use a scaling animation to make the button disappear as opposed to simply hiding it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onStartNestedScroll</span><span class="o">(...)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">nestedScrollAxes</span> <span class="o">==</span> <span class="n">ViewCompat</span><span class="o">.</span><span class="na">SCROLL_AXIS_VERTICAL</span>
</span><span class='line'>            <span class="o">||</span> <span class="kd">super</span><span class="o">.</span><span class="na">onStartNestedScroll</span><span class="o">(</span><span class="n">coordinatorLayout</span><span class="o">,</span>
</span><span class='line'>            <span class="n">child</span><span class="o">,</span> <span class="n">directTargetChild</span><span class="o">,</span> <span class="n">target</span><span class="o">,</span> <span class="n">nestedScrollAxes</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onNestedScroll</span><span class="o">(...)</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">super</span><span class="o">.</span><span class="na">onNestedScroll</span><span class="o">(...);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="n">dyConsumed</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="na">isAnimatingOut</span>
</span><span class='line'>    <span class="o">&amp;&amp;</span> <span class="n">child</span><span class="o">.</span><span class="na">getVisibility</span><span class="o">()</span> <span class="o">==</span> <span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">animateOut</span><span class="o">(</span><span class="n">child</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">dyConsumed</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>    <span class="n">child</span><span class="o">.</span><span class="na">getVisibility</span><span class="o">()</span> <span class="o">!=</span> <span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">animateIn</span><span class="o">(</span><span class="n">child</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">animateOut</span><span class="o">(</span><span class="kd">final</span> <span class="n">FloatingActionButton</span> <span class="n">button</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">button</span><span class="o">.</span><span class="na">setScaleX</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>    <span class="n">button</span><span class="o">.</span><span class="na">setScaleY</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>    <span class="n">button</span><span class="o">.</span><span class="na">animate</span><span class="o">()</span>
</span><span class='line'>            <span class="o">.</span><span class="na">scaleX</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">scaleY</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">setInterpolator</span><span class="o">(</span><span class="n">animationInterpolator</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Conclusion</h1>

<p>The <code>Design Support Library</code> is a huge improvement in the Android development world. It&rsquo;s never been so easy to follow the design patterns that Google puts in place, there are no more excuses now. We have all the tools needed in order to build proper Material Design applications on Android.</p>

<p>In terms of <a href="https://play.google.com/store/apps/details?id=com.malmstein.yahnac">Yahnac</a>. The application is now updated with what you&rsquo;ve seen here and it&rsquo;s now a much better Hacker News client.</p>

<p>In case you are interested, I&rsquo;ve created a <a href="https://plus.google.com/communities/108233780766400792163">Google+ Community</a> where you are more than welcome to provide feedback, bug reports or any other related question. Looking forward to it!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">David Gonzalez</span></span>

      




<time class='entry-date' datetime='2015-09-20T09:37:48+01:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:37 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/coordinator-layout/'>coordinator-layout</a>, <a class='category' href='/blog/categories/material-design/'>material-design,</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://malmstein.github.io/blog/2015/09/20/yahnac-meets-the-material-design-library/" data-via="dggonzalez" data-counturl="http://malmstein.github.io/blog/2015/09/20/yahnac-meets-the-material-design-library/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/04/05/yahnacs-rx-pipeline/" title="Previous Post: Building Yahnac's Rx pipeline">&laquo; Building Yahnac&#8217;s Rx pipeline</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/11/28/introduction-to-google-eddystone/" title="Next Post: Introduction to Google Eddystone">Introduction to Google Eddystone &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/11/28/introduction-to-google-eddystone/">Introduction to Google Eddystone</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/20/yahnac-meets-the-material-design-library/">Yahnac Meets the Design Support Library</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/05/yahnacs-rx-pipeline/">Building Yahnac&#8217;s Rx Pipeline</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/28/introducing-yahnac-where-rxjava-meets-content-providers/">Introducing Yahnac: Where RxJava Meets Firebase and Content Providers</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/15/finishing-your-very-first-android-tv-application/">Finishing Your Very First Android TV Application</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/malmstein">@malmstein</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'malmstein',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/+DavidGonzÃ¡lezNovoda?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - David Gonzalez -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'malmstein';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://malmstein.github.io/blog/2015/09/20/yahnac-meets-the-material-design-library/';
        var disqus_url = 'http://malmstein.github.io/blog/2015/09/20/yahnac-meets-the-material-design-library/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
